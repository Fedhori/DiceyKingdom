# 게임 구조

이 문서는 DiceyKingdom의 게임 구조/시스템/런타임 흐름을 정리합니다. 레포 지도는 `Docs/PROJECT_MAP.md`, 범용 규칙은 `Docs/GENERAL_RULES.md`를 참고합니다.

## 문서 범위/분리 기준

- 범용 규칙/컨벤션: `Docs/GENERAL_RULES.md`
- 레포 지도(파일 위치/책임 요약): `Docs/PROJECT_MAP.md`
- 아이디어 원문/백로그: `Docs/GAME_IDEA_BACKLOG.md`
- 이 문서: 실제 구현 기준이 되는 게임 구조, 시스템, 데이터/씬 흐름

## 프로덕트 요약 (한 줄)

- 2D 판타지 왕국의 왕이 되어, 매 턴 주사위를 분배해 위기를 관리하는 턴제 로그라이크 경영 게임.

## 게임 컨셉

- 플레이어는 왕국의 군주로서 매 턴 주사위를 굴리고, 보드에 쌓이는 상황 카드를 해결해 왕국을 생존시킵니다.
- 핵심 생존 자원은 `안정도`이며, 안정도가 0 이하가 되면 즉시 게임 오버입니다.
- 현재 기준 진행 목표는 엔딩형이 아닌 생존형(얼마나 오래 버티는지)으로 정의합니다.

## 씬/런타임 흐름

- `Bootstrap` -> `MainMenu` -> `RunScene` 진입
- `RunScene`에서 단일 런이 진행되며, 턴 단위로 상황 생성/해결/정산을 반복
- 런 종료 조건: 안정도 0 이하

## 핵심 루프

1. 턴 시작
2. 상황 보드 갱신(신규 상황 추가, 지속 효과 갱신)
3. 주사위 배치(상황 카드별 슬롯에 주사위 할당)
4. 주사위 굴림 및 수치 차감
5. 스킬/아이템 사용으로 결과 보정
6. 턴 종료 정산(남은 턴수 감소, 성공/실패 처리, 안정도 증감)
7. 다음 턴 반복

## 데이터 로딩

- 템플릿은 `SaCache` + `StaticDataManager` 기반의 JSON 로딩 흐름을 제공합니다.
- 프로젝트 초안 데이터 테이블:
  - `Situations.json`: 상황 카드 정의
  - `DiceBuffs.json`: 주사위 강화 정의
  - `Skills.json`: 액티브 스킬 정의
  - `Legacies.json`: 영구 패시브(유산) 정의
  - `Consumables.json`: 일회성 아이템 정의

## 저장/로드

- 템플릿은 `SaveService` 기반의 일반 저장/로드 유틸을 제공합니다.
- 런타임 저장 스키마 초안:
  - 현재 턴 수
  - 현재 안정도/최대 안정도
  - 보유 주사위/강화 상태
  - 보유 스킬/쿨다운 상태
  - 보유 유산
  - 보드 위 상황 카드 상태(남은 턴수/남은 슬롯 수치/적용된 상태이상)
  - 기타 자원(예: 골드)

## UI/UX 공용 시스템

- 모달/토스트/툴팁/플로팅 텍스트는 공용 UI 유틸로 제공됩니다.
- 런 보드 UI 요구사항 초안:
  - 상황 카드별 태그, 남은 턴수, 슬롯 목표치, 보상/실패 효과 표시
  - 주사위 배치 가능/불가 상태 가시화
  - 스킬 쿨다운 및 사용 가능 조건 표시
  - 안정도 변화 로그 표시

## 오디오

- `AudioManager`(SFX), `BgmManager`(BGM) 공용 유틸 제공.

## 난수

- 주사위 굴림은 `System.Random` 기반으로 처리합니다.
- 재현성(디버깅/시드 런)이 필요하므로 런 시작 시 시드를 저장합니다.

## 텍스트 스타일(프로젝트별)

- 기준: `Assets/GlobalTextStyles.asset`
- TODO: 프로젝트 스타일 이름 확정 후 반영

## 핵심 시스템 규칙(초안)

### 안정도
- 왕국의 체력 역할을 수행합니다.
- 상황 실패, 디버프, 이벤트 등에 의해 감소합니다.
- 보상, 유산, 고정 행동(예: 영지 순찰) 등으로 회복할 수 있습니다.

### 주사위
- 매 턴 플레이어는 보유한 주사위를 굴립니다.
- 기본 주사위 눈 범위는 1~6입니다.
- 각 주사위는 강화 1개를 장착할 수 있습니다.
- 강화 예시:
  - 모든 눈 +1
  - 최소 1회 리롤 보장
  - 2회 굴림 후 높은 눈 채택

### 상황 카드
- 상황 카드는 `태그`, `남은 턴수`, `슬롯 목표치`, `실패 효과`, `성공 보상`을 가집니다.
- 하나의 상황은 여러 슬롯을 가질 수 있으며, 모든 슬롯을 해결해야 성공합니다.
- 카드별로 턴당 배치 가능한 최대 주사위 수가 존재할 수 있습니다.
- `영지 순찰`처럼 상시 재생성되는 무기한 카드도 존재할 수 있습니다.

### 스킬
- 액티브 능력으로 턴 쿨다운을 가집니다.
- 주사위 재굴림, 눈 보정, 상황 턴 연장 등 전술적 보정을 담당합니다.
- 일부 스킬은 상황당 사용 횟수 제한을 가집니다.

### 유산
- 런 동안 유지되는 영구 패시브입니다.
- 빌드 방향성과 장기 성능을 결정하는 핵심 성장 축입니다.

### 일회성 아이템
- 특정 태그/상황에 강한 즉시 사용형 카드입니다.
- 연출 테마는 칙령/문서류(소모성 정책 발동) 방향을 기본안으로 둡니다.

## 턴 처리 규칙(초안)

1. 턴 시작: 신규 상황 카드가 규칙에 따라 보드에 추가됩니다.
2. 배치 단계: 플레이어가 상황 슬롯에 주사위를 할당합니다.
3. 굴림 단계: 할당 주사위를 굴려 슬롯 목표치를 감소시킵니다.
4. 보정 단계: 스킬/아이템을 사용해 눈 또는 상황 상태를 조정합니다.
5. 종료 정산:
   - 미해결 카드의 남은 턴수를 감소시킵니다.
   - 남은 턴수가 0이 된 미해결 상황은 실패 처리합니다.
   - 모든 슬롯 해결 상황은 성공 처리 후 보드를 이탈합니다.
6. 안정도 0 이하 여부를 판정합니다.

## 예시 진행(문서화)

- 초기 상태
  - 주사위 4개(기본 3, 2회 굴림 후 높은 눈 채택 강화 1)
  - 스킬: 대상 상황 남은 턴수 +1(쿨다운 4, 상황당 1회)
  - 유산: 이번 턴 최저 눈 +1
- 보드 상황
  - `오크 부대`(침략): 남은 턴수 1, 목표치 10, 최대 3주사위
  - `메뚜기 떼`(기근): 남은 턴수 2, 목표치 5/8
- 배치/굴림 결과
  - 오크 부대에 3주사위 배치 -> 4, 2, 3 합계 9
  - 메뚜기 떼 5 슬롯에 1주사위 배치 -> 6으로 슬롯 해결
- 판정
  - 오크 부대 목표치 1 남음 -> 실패 위험
  - 스킬 사용으로 오크 부대 남은 턴수 +1
  - 다음 턴에 잔여 목표치(오크 1, 메뚜기 8)를 이어서 해결

## 밸런스 기준(초안)

- 판단 강도: 매 턴 "모든 문제 해결"이 아니라 "무엇을 포기할지"를 결정하게 설계
- 시너지 가치: 단일 고성능 옵션보다 조합(주사위 강화 + 스킬 + 유산)이 더 강하도록 설계
- 리스크 관리: 단기 손해를 감수해 장기 성장(유산/강화)을 선택할 여지를 보장

## 미해결 설계 질문

- 런 클리어 조건을 생존형으로 고정할지, 특정 턴/보스 목표를 둘지
- 상황 카드 생성 규칙(턴당 생성 수, 태그 분포, 난이도 가중치)
- 보상 획득 타이밍(즉시 지급 vs 턴 종료 지급)
- 오버킬 처리 방식(남는 수치 이월 여부 + 오버킬 트리거/보상 규칙)
- 주사위 배치 이후 재배치 허용 여부

## 관련 문서

- 공통 규칙: `Docs/GENERAL_RULES.md`
- 레포 지도: `Docs/PROJECT_MAP.md`
- 아이디어 백로그: `Docs/GAME_IDEA_BACKLOG.md`
