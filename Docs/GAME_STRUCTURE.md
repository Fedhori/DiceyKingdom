# 게임 구조

이 문서는 DiceyKingdom의 게임 구조/시스템/런타임 흐름을 정리합니다. 레포 지도는 `Docs/PROJECT_MAP.md`, 범용 규칙은 `Docs/GENERAL_RULES.md`를 참고합니다.

## 문서 범위/분리 기준

- 범용 규칙/컨벤션: `Docs/GENERAL_RULES.md`
- 레포 지도(파일 위치/책임 요약): `Docs/PROJECT_MAP.md`
- 아이디어 원문/백로그: `Docs/GAME_IDEA_BACKLOG.md`
- v0 마일스톤 추적: `Docs/V0_MILESTONE.md`
- 상황 컨셉/대응 요약: `Docs/ENEMY_ROSTER.md`
- 이 문서: 실제 구현 기준이 되는 게임 구조, 시스템, 데이터/씬 흐름

## 프로덕트 요약 (한 줄)

- 2D 판타지 왕국의 왕이 되어, 매 턴 주사위를 분배해 위기를 관리하는 턴제 로그라이크 경영 게임.

## 현재 개발 단계(중요)

- 기준일: 2026-02-11
- 현재 최우선 목표는 "완성 기획 고정"이 아니라 "핵심 컨셉 검증용 플레이어블 v0 빌드" 제작입니다.
- 핵심 검증 가설:
  - 결과가 불확실한 자원을 분배하는 행위 자체가 반복 플레이에서 재미를 제공하는가
- 1차 검증 기준(확정):
  - 플레이 중/종료 후 "재미 신호"가 명확하게 감지되는가
  - 약 `10`회 플레이에서도 재미 신호가 거의 없으면 아이디어를 중단 후보로 판정
- v0 가드레일(확정):
  - 분배 단위를 모험가로 실험할 경우, 단위 수는 `4`로 고정
  - 스킬 최소 세트 3종을 기본 보유로 시작
    - 원하는 모험가 리롤(쿨다운 `1`)
    - 원하는 주사위 눈 +1(쿨다운 `1`)
    - 지정 상황 요구치 -2(쿨다운 `2`)
  - 모든 스킬은 개별 쿨다운을 가지며, 각 스킬은 턴당 `1`회만 사용 가능
  - 검증 초점은 "모험가 <-> 스킬 시너지의 재미 체감"으로 둠
- 실험 전략(확정):
  - `선택지 A` 적용: 분배 단위만 모험가로 전환하고, 진행 구조는 기존 연속 누적 턴 보드를 유지
  - 이번 사이클에서는 단일 빌드로 플레이테스트 수행
  - 스테이지 단위 + 준비시간 액션 구조는 차기 사이클 후보로 보류
  - 세션 평가는 코드 로그가 아닌 플레이어 수동 피드백으로 진행
- 문서 내 기존 세부 규칙/수치/용어는 참고 베이스라인이며, v0 결과에 따라 구조적 변경(예: 분배 단위/보드 구조) 가능성이 열려 있습니다.
- 충돌 시 우선순위:
  - v0 검증 목표 > 기존 상세 규칙

### 2026-02-11 우선순위 리워크 규칙(확정)

- `Enemy(몬스터)` 용어를 `Situation(상황)`으로 전환합니다.
- `Health(체력/HP)` 용어를 `Requirement(요구치)`로 전환합니다.
- 상황의 `행동(Action)` 및 `행동 풀(action_pool)` 시스템은 v0 범위에서 폐기합니다.
- 각 상황은 아래 3개를 가집니다.
  - `기한(Deadline)`
  - `성공 시 보상(Success Reward)`
  - `실패 시 효과(Failure Effect)`
- 성공 판정:
  - 요구치가 `0` 이하가 되는 즉시 성공 처리하고, 성공 보상을 적용한 뒤 보드에서 제거합니다.
- 실패 판정:
  - `P5 Settlement`에서 기한을 감소시킨 뒤, `0` 이하이면 실패 처리합니다.
  - 실패 시 기본 동작은 실패 효과를 적용하고 보드에서 제거합니다.
- 신규 상황 생성 규칙:
  - 런 시작 시 초기 상황 `3`개를 생성합니다.
  - `4`턴마다 신규 상황 `3`개를 생성합니다.
  - 생성 대상은 상황 풀에서 `균등 랜덤`으로 선택합니다.
  - 보드 최대 상황 수 상한은 두지 않습니다.
- 스킬 `지정 몬스터 피해 2`는 `지정 상황 요구치 -2`로 전환합니다.
- 이 절의 규칙은 문서 내 기존 `Enemy/action_pool` 관련 서술보다 우선합니다.

### v0 구현 범위(확정)

- 포함:
  - 분배 단위를 모험가로 전환
  - 모험가 수 `4` 고정
  - 스킬 3종 기본 보유(리롤 CD1, 눈 +1 CD1, 상황 요구치 -2 CD2)
  - 스킬 규칙: 개별 쿨다운 + 각 턴당 스킬별 1회 사용
  - 전투 계산: 상황은 요구치를 가지며, 모험가 주사위 눈 합으로 요구치를 감소
  - 기존 연속 누적 턴 보드 구조 유지
  - 런 종료 조건 `Stability <= 0`
- 제외:
  - v0 보상 시스템(처치 보상/스테이지 보상)
  - 스테이지 단위 + 준비시간 액션 구조
  - 모험가 수 증가(4->5->6)
  - 확장 성장 시스템/경제 확장/메타 진행
  - 런 종료 설문/자동 로그 수집 기능

### v0 런 파라미터 잠금(확정)

- 초기 안정도(`Stability`)는 `20`으로 고정합니다.
- 초기 골드(`Gold`)는 `0`으로 고정합니다.
- v0 현재 실험값으로, 4명의 모험가는 모두 `dice_count = 4`를 사용합니다.
- 런 시작 시 초기 상황 `3`개를 생성합니다.
- 신규 상황 생성 규칙은 `4`턴마다 `3`개 생성으로 고정합니다.
- 상황 생성은 사전 제작 데이터 풀에서 `균등 랜덤`으로 선정합니다.
- 보드 최대 상황 수 상한은 두지 않습니다.

### v0 구현 순서

1. 모험가 최소 데이터 스키마 정의(굴림 주사위 수, 고유 효과, 장비 슬롯)
2. 모험가 배치/전투 루프 신규 구현(템플릿 기본 코드만 존재하므로 치환 작업 없음)
3. 스킬 3종 효과 구현(리롤, 눈 +1, 상황 요구치 -2)
4. 스킬 사용 UI/피드백 구현(선택 대상 표시, 사용 가능/쿨다운 상태 표시)
5. 연속 턴 보드에서 상황 요구치/기한 정산이 모험가 체계와 맞물리도록 연결
6. 플레이 가능한 빌드 완성 후 사용자 수동 플레이테스트 진행

## 게임 컨셉

- 플레이어는 왕국의 군주로서 매 턴 주사위를 굴리고, 보드에 쌓이는 상황을 대응하며 왕국을 생존시킵니다.
- 핵심 생존 자원은 `안정도`이며, 안정도가 0 이하가 되면 즉시 게임 오버입니다.
- `V1` 진행 목표는 엔딩형이 아닌 생존형(얼마나 오래 버티는지)으로 고정합니다.

## 런 목표(V1 확정)

- `V1` 런 목표는 생존형 1종만 사용합니다.
- 런 종료 조건은 `Stability <= 0`입니다.
- 보스/엔딩/특수 승리 조건은 `V2` 이후 확장 항목으로 분리합니다.

## 용어 사전(확정)

- `Situation` / `상황`
  - 보드에 생성되는 문제/기회 단위
- `Enemy` / `몬스터`
  - 레거시 용어(2026-02-11 이후 신규 설계에서는 사용하지 않음)
- `Skill` / `스킬`
  - 액티브 능력 카테고리(인물 테마)
- `Structure` / `구조물`
  - 영구 패시브 카테고리(건물/시설 테마)
- `Decree` / `칙령`
  - 즉시 사용 소모성 수단
- `Stability` / `안정도`
  - 왕국 생존 자원(0 이하 시 게임 오버)
- `Gold` / `골드`
  - 런 내 공용 경제 통화
- `Health` / `체력`
  - 레거시 용어(요구치로 대체)
- `Requirement` / `요구치`
  - 상황 해결을 위해 감소시켜야 하는 수치
- `Deadline` / `기한`
  - 상황이 실패 판정되기까지 남은 턴 수
- `Attack` / `공격`
  - 모험가 주사위 눈의 합으로 생성되는 피해량
- `Tags` / `태그`
  - 상황/효과 분류 키워드(예: 침략, 기근)
- `Run` / `런`
  - 게임 1회 플레이 단위
- `Turn` / `턴`
  - 런 내 최소 진행 단위
- `Phase` / `페이즈`
  - 턴 내부 고정 단계

### 용어 사용 규칙(확정)

- 문서/코드/데이터/UI에서 같은 개념은 항상 동일 용어를 사용합니다.
- 한글 표기 우선, 영문은 괄호로 병기합니다.
- 기존 표현은 점진적으로 `스킬(Skill)`, `구조물(Structure)`, `칙령(Decree)` 기준으로 통일합니다.
- 경제 용어는 `재화` 대신 `골드(Gold)`를 기본 표기로 사용합니다.

## 디자인 철학(확정)

- 목표는 플레이어를 괴롭히는 것이 아니라, 도전적인 난이도에서 시너지 탐색/실험/실현의 성취감을 제공하는 것입니다.
- 난이도와 보상은 함께 설계하며, "어려움만 있고 보상이 없는 상태"를 피합니다.
- 소모품을 한 턴에 집중 사용해 폭발적인 결과를 만드는 플레이는 허용하되, 그 전제는 충분한 희소성과 기회비용입니다.
- 강력한 시너지는 만들기 어렵게 설계하고, 특정 고점 전략이 모든 상황에 통하지 않도록 카운터 기믹을 함께 배치합니다.
- 선택은 흥미로워야 하며, 과도한 복잡도로 인해 피로를 유발하는 설계는 지양합니다.
- 모든 효과는 "한 번 읽고 이해 가능한 단문 규칙"을 우선하며, 길고 조건이 많은 효과는 예외적으로만 허용합니다.

## 씬/런타임 흐름

- 현재 구현 기준: `Bootstrap` -> `GameScene` 진입
- `GameScene`에서 단일 런이 진행되며, 턴 단위로 상황 대응/정산을 반복
- 런 종료 조건: 안정도 0 이하

## 핵심 루프

1. 턴 시작
2. 보드 갱신(상황 생성/만료 대상 확인)
3. 모험가 순차 처리 루프
   - 모험가 1명 선택 -> 굴리기 -> 보정 -> 드래그 공격(소비)
   - 남은 모험가가 있으면 반복
4. 턴 종료 정산(미해결 상황 기한 감소, 실패 효과 적용, 안정도/골드 증감)
5. 다음 턴 반복

## 데이터 로딩

- 템플릿은 `SaCache` + `StaticDataManager` 기반의 JSON 로딩 흐름을 제공합니다.
- 프로젝트 초안 데이터 테이블:
  - `Situations.json`: Situation 정의 + 4턴 주기 균등 랜덤 생성 풀(단일 파일)
  - `DiceBuffs.json`: 주사위 강화 정의
  - `Skills.json`: Skill 정의
  - `Legacies.json`: Structure 정의
  - `Consumables.json`: Decree 정의

## 저장/로드

- 템플릿은 `SaveService` 기반의 일반 저장/로드 유틸을 제공합니다.
- 런타임 저장 스키마 초안:
  - 현재 턴 수
  - 현재 안정도/최대 안정도
  - 보유 주사위/강화 상태
  - 보유 스킬/쿨다운 상태
  - 보유 구조물
  - 보드 위 상황 상태(현재 요구치/남은 기한/성공·실패 처리 상태)
  - 경제 값(골드)

## UI/UX 공용 시스템

- 모달/토스트/툴팁/플로팅 텍스트는 공용 UI 유틸로 제공됩니다.
- 런 보드 카드/주사위 UI는 프리팹 기반으로 구성합니다.
  - 상황 카드: `Assets/Prefabs/Situation/SituationCard.prefab`
  - 모험가 카드: `Assets/Prefabs/Adeventurer/AdventurerCard.prefab`
  - 주사위: `Assets/Prefabs/Dice/Dice.prefab`
- 카드/주사위의 크기, 피벗, 오프셋, 레이아웃 수치는 프리팹(또는 프리팹 인스턴스)에서 관리하고, 코드에서는 상태 바인딩만 담당합니다.
- 런 보드 UI는 매 프레임 폴링(`Update`)으로 상태를 갱신하지 않고, 런타임 이벤트(`RunStarted`, `PhaseChanged`, `StageSpawned`, `RunEnded`, `StateChanged`) 기반으로만 갱신합니다.
- 런 보드 UI 요구사항 초안:
  - 상단 HUD에 `Turn`, `Stage`, `Phase`, `Stability`, `Gold`, `Run` 상태를 고정 표시
  - 상황 카드별 태그, 요구치, 남은 기한, 성공 보상/실패 효과 요약 표시
  - 모험가 배치 가능/불가 상태 가시화
  - 드래그 타게팅 중 연결 라인/화살표 표시
  - 스킬 쿨다운 및 사용 가능 조건 표시
  - `P4` 종료 시 미배치 모험가 경고 모달 표시
  - 안정도 변화 로그 표시

### 상태-UI 동기화 규칙(v0)

- 상단 HUD는 아래 이벤트로 동기화합니다.
  - `RunStarted`: 런 시작 상태 반영
  - `PhaseChanged`: 현재 페이즈 반영
  - `StageSpawned`: 스테이지 번호/프리셋 반영
  - `RunEnded`: 게임오버 상태 반영

## 오디오

- `AudioManager`(SFX), `BgmManager`(BGM) 공용 유틸 제공.

## 난수

- 주사위 굴림은 `System.Random` 기반으로 처리합니다.
- 재현성(디버깅/시드 런)이 필요하므로 런 시작 시 시드를 저장합니다.

## 텍스트 스타일(프로젝트별)

- 기준: `Assets/GlobalTextStyles.asset`
- TODO: 프로젝트 스타일 이름 확정 후 반영

## 핵심 시스템 규칙(초안)

### 안정도
- 왕국의 체력 역할을 수행합니다.
- 상황 실패, 디버프, 이벤트 등에 의해 감소합니다.
- 효과, 유산, 고정 행동(예: 영지 순찰) 등으로 회복할 수 있습니다.

### 주사위
- 매 턴 플레이어는 보유한 주사위를 굴립니다.
- 기본 주사위 눈 범위는 1~6입니다.
- 각 주사위는 강화 1개를 장착할 수 있습니다.
- 강화 예시:
  - 모든 눈 +1
  - 최소 1회 리롤 보장
  - 2회 굴림 후 높은 눈 채택

### 모험가(Adventurer)

- 모험가는 플레이어가 턴마다 상황에 배치하는 전투 단위입니다.
- 각 모험가는 자신의 주사위를 굴려 `공격` 값을 생성합니다.
- 한 턴에 한 모험가는 하나의 상황에만 배치할 수 있습니다.

### 모험가 최소 스키마(v0 확정)

- 정적 데이터(`AdventurerDef`):
  - `adventurer_id`: string (고유 ID)
  - `name_key`: string (로컬라이즈 키)
  - `dice_count`: int (`>= 1`)
  - `gear_slot_count`: int (`>= 0`)
  - `innate_effect`: effect_bundle or null (고유 패시브/전투 효과)
- 런타임 데이터(`AdventurerState`):
  - `instance_id`: string (런 내 모험가 인스턴스 ID)
  - `adventurer_def_id`: string (`AdventurerDef.adventurer_id` 참조)
  - `rolled_dice_values`: int[] (`P3` 결과값)
  - `assigned_situation_instance_id`: string or null (`P4` 드래그 공격 대상)
  - `action_consumed`: bool (`P4`에서 공격 반영 완료 여부)
- v0 처리 규칙:
  - 런 시작 시 모험가 슬롯은 `4`개로 고정합니다.
  - 각 모험가는 `dice_count`만큼 기본 d6(1~6)을 굴립니다.
  - `P2`에서 배치되지 않은 모험가는 `P4`에서 공격에 기여하지 않습니다.
  - `P4`에서 모험가의 공격 반영이 끝나면 `action_consumed = true`로 확정합니다.
  - 턴 종료 시 모험가 배치/굴림/소비 상태는 다음 턴 시작에 리셋됩니다.

### 상황(Situation) (2026-02-11 확정)

- 상황은 `태그`, `요구치(Requirement)`, `기한(Deadline)`, `성공 보상`, `실패 효과`를 가집니다.
- 모험가가 굴린 주사위 눈 합은 해당 상황의 `요구치`를 감소시키는 `공격`으로 적용됩니다.
- 상황 요구치가 0 이하가 되면 즉시 성공 처리하고, 보상 적용 후 보드에서 제거합니다.
- 상황 행동/행동 풀 시스템은 폐기하며, 위협은 기한 만료 실패 효과로 표현합니다.

### 상황 최소 스키마(v0 확정)

- 정적 데이터(`SituationDef`):
  - `situation_id`: string (고유 ID)
  - `name_key`: string (로컬라이즈 키)
  - `tags`: string[] (예: `invasion`, `famine`)
  - `base_requirement`: int (`>= 1`)
  - `base_deadline_turns`: int (`>= 1`)
  - `success_reward`: effect_bundle
  - `failure_effect`: effect_bundle
  - `failure_persist_mode`: string (`remove` | `reset_deadline`) (현재 v0는 `remove`만 사용)
- 런타임 데이터(`SituationState`):
  - `instance_id`: string (보드 인스턴스 ID)
  - `situation_def_id`: string (`SituationDef.situation_id` 참조)
  - `current_requirement`: int
  - `deadline_turns_left`: int
  - `resolved_this_turn`: bool
- v0 처리 규칙:
  - 스폰 시 `current_requirement = base_requirement`, `deadline_turns_left = base_deadline_turns`
  - `P4`에서 `current_requirement <= 0`이 되면 즉시 성공 처리(보상 획득 후 제거)
  - `P5`에서 미해결 상황의 `deadline_turns_left -= 1`
  - 감소 후 `deadline_turns_left <= 0`이면 실패 처리
  - 실패 기본 동작은 실패 효과 적용 후 제거(`remove`)
  - `failure_persist_mode = reset_deadline`은 데이터에서 선택 가능하며, 선택 시 실패 후 기한을 기본값으로 초기화해 잔류합니다.

### 행동/행동 풀 폐기 규칙(확정)

- `action_pool`, `current_action_id`, `action_turns_left`는 신규 설계에서 사용하지 않습니다.
- 기존 몬스터 행동 로직은 상황 기한/성공·실패 로직으로 대체합니다.

### 범용 효과 스키마(v0 확정)

- 효과 포맷은 참조형이 아니라 `범용형(effect_bundle)`으로 고정합니다.
- `effect_bundle`:
  - `effects`: effect_spec[]
- `effect_spec`(JSON, snake_case):
  - `effect_type`: string (필수)
  - `value`: number or null
  - `params`: object or null
- 부호 규칙:
  - 증가는 양수, 감소는 음수로 통일합니다.
- v0 최소 지원 `effect_type`:
  - `stability_delta`
  - `gold_delta`
  - `situation_requirement_delta`
  - `die_face_delta`
  - `reroll_adventurer_dice`
- `effect_type`별 `params` 필수 키 규칙(v0 확정):
  - `stability_delta`
    - 필수 키 없음 (`params = null`)
  - `gold_delta`
    - 필수 키 없음 (`params = null`)
  - `situation_requirement_delta`
    - 필수: `target_mode`
    - 허용값: `selected_situation`
  - `die_face_delta`
    - 필수: `target_adventurer_mode`, `die_pick_rule`
    - 허용값:
      - `target_adventurer_mode`: `selected_adventurer`
      - `die_pick_rule`: `selected` | `lowest` | `highest` | `all`
  - `reroll_adventurer_dice`
    - 필수: `target_adventurer_mode`, `reroll_rule`
    - 허용값:
      - `target_adventurer_mode`: `selected_adventurer`
      - `reroll_rule`: `all` | `single`

### 스킬(Skill)
- 액티브 능력으로 턴 쿨다운을 가집니다.
- 주사위 재굴림, 눈 보정, 즉시 피해 등 전술적 보정을 담당합니다.
- 일부 스킬은 대상 상황당 사용 횟수 제한을 가질 수 있습니다.
- 쿨다운이 0이 되면 해당 턴에 즉시 사용 가능합니다.

### 구조물(Structure)
- 런 동안 유지되는 영구 패시브입니다.
- 빌드 방향성과 장기 성능을 결정하는 핵심 성장 축입니다.
- 테마는 건물/시설/설치물 방향으로 고정합니다.

### 칙령(Decree)
- 특정 태그/상황에 강한 즉시 사용형 카드입니다.
- 연출 테마는 칙령/문서류(소모성 정책 발동) 방향을 기본안으로 둡니다.
- 포지션은 "위기 대응용 윤활유"이며, 희소 공급 + 구매 기회비용을 통해 상시 정답 전략화를 방지합니다.

## 턴 처리 규칙(부분 확정)

1. 턴 시작: 보드 상태를 갱신합니다.
2. 모험가 처리 루프(모험가 수만큼 반복):
   - 처리할 모험가를 선택하고 `굴리기`를 실행합니다.
   - 굴림값을 스킬/칙령으로 조정합니다.
   - 조정이 끝난 모험가를 `Situation`에 드래그해 공격으로 소비합니다.
3. 종료 정산(미해결 상황 대상):
   - 미해결 상황의 기한을 1 감소시킵니다.
   - 기한이 0 이하가 된 상황은 실패 효과를 즉시 발동합니다.
   - 실패 기본 동작은 제거입니다(현재 v0에서 실패 잔류 없음).
4. 안정도 0 이하 여부를 판정합니다.

### 턴 최소 사이클 단위(상태머신 부분 확정)

- 용어 정의
  - `Phase`: 턴을 구성하는 고정 단계
  - `Window`: 플레이어가 스킬/칙령 등 능동 효과를 사용할 수 있는 구간
  - `Commit`: 해당 단계 결과가 확정되어 되돌릴 수 없는 지점
- 사이클 정의
  - `P0 TurnStart`
    - 주사위 리필, 스킬 쿨다운 감소, 턴 시작 트리거 처리
    - `Commit`: 리필/쿨다운 결과 확정
- `P1 BoardUpdate`
    - 보드 상태 갱신(턴 시작형 지속효과 포함)
    - 런 시작 시 초기 상황 `3`개 생성
    - `4`턴마다 상황 `3`개 생성
    - 생성 대상은 상황 풀에서 `균등 랜덤` 선택
    - `Commit`: 이번 턴 보드 구성 확정
  - `P2 AdventurerRoll`
    - 현재 처리할 모험가를 선택하고 굴림 입력을 수행
    - 입력: 모험가별 `굴리기` 버튼 또는 단축키 `1/2/3/4`
    - 현재 모험가가 굴려지면 다른 모험가 굴림 입력은 일시 비활성화
    - `Window`: 스킬/칙령 사용 가능
    - `Commit`: 현재 모험가 원시 굴림값 확정
  - `P3 Adjustment`
    - 현재 모험가 굴림값/상황 상태를 보정하는 효과 처리
    - `Window`: 스킬/칙령 사용 가능
    - `Commit`: 현재 모험가 최종 공격값 확정
  - `P4 TargetAndAttack`
    - 현재 모험가를 `Situation`에 드래그해 공격 적용
    - 상황 요구치 0 이하 시 즉시 `성공` 처리(보상 적용 후 제거)
    - `Commit`: 현재 모험가 공격/소비 확정
    - 남은 미소비 모험가가 있으면 `P2`로 돌아가 다음 모험가를 처리
  - `P5 Settlement`
    - 내부 순서:
      1. 미해결 상황의 기한 1 감소
      2. 기한 0 이하 상황의 실패 효과 발동
      3. 실패 기본 동작은 제거(현재 v0에서 잔류 없음)
    - `Commit`: 턴 결과 확정
  - `P6 EndTurn`
    - 턴 종료형 지속효과 처리, 게임오버 판정
    - 다음 턴으로 이행

### 턴 시작 리필 규칙(확정)

- 플레이어 보유 주사위는 턴 시작 시 전부 리필됩니다.
- 플레이어 보유 스킬의 쿨다운은 턴 시작 시 감소합니다.
- 쿨다운이 0이 된 스킬은 같은 턴에 즉시 사용 가능합니다.

### 스킬/칙령 사용 규칙(확정)

- 모든 스킬은 개별 쿨다운을 가집니다.
- 각 스킬은 턴당 `1`회만 사용 가능합니다.
- 이는 "최대 사용 가능 횟수" 제한이며, 매 턴 반드시 사용해야 한다는 뜻은 아닙니다.
- v0 스킬 쿨다운 값:
  - 원하는 모험가 리롤: `1`
  - 원하는 주사위 눈 +1: `1`
  - 지정 상황 요구치 -2: `2`
- 턴당 소모품 사용 횟수 제한은 없습니다.
- 효과 비용은 대부분 무료를 기본값으로 보되, 일부 스킬/칙령은 골드 비용을 가질 수 있습니다.
- 사용 윈도우는 `P2 AdventurerRoll`, `P3 Adjustment`, `P4 TargetAndAttack`로 제한합니다.
- v0 기본 스킬 3종의 사용 윈도우는 아래로 고정합니다.
  - 리롤(`reroll_adventurer_dice`): `P3` 전용
  - 눈 +1(`die_face_delta`): `P3` 전용
  - 상황 요구치 -2(`situation_requirement_delta`): `P2`, `P4`
- 순차 처리에서는 "현재 처리 중인 모험가"를 기준으로만 대상 지정이 가능합니다.
- 스킬 입력 방식은 `스킬 슬롯 클릭` 또는 `Q/W/E/R` 단축키 선택 후, 유효 타깃 클릭으로 고정합니다.
- 턴 종료 입력은 하단 중앙 `End Turn` CTA 버튼 또는 `Space` 단축키를 사용합니다.
- 선택된 스킬의 유효 타깃은 하이라이트로 표시합니다.
- 스킬 선택 취소는 아래 둘 중 하나로 수행합니다.
  - 같은 스킬 슬롯/단축키를 다시 입력
  - 빈 공간 클릭
- `P5 Settlement` 및 `P6 EndTurn`에서는 스킬/칙령을 사용할 수 없습니다.
- 비용이 있는 효과는 항상 사용 전에 비용을 지불합니다.
- 골드가 부족하면 해당 효과는 사용할 수 없습니다.
- 사용 가능/불가 상태는 UI에서 즉시 식별 가능해야 합니다.
- 소모품은 턴당 제한이 아니라 보유량 한도로 관리합니다.
- v0에서는 무쿨다운 스킬을 사용하지 않습니다.

### 모험가 배치/소비 규칙(확정)

- 턴 내 모험가 처리 순서는 "굴리기 -> 조정 -> 드래그 공격"을 반복하는 순차 처리입니다.
- `전체 모험가 롤 후 타게팅`은 사용하지 않습니다.
- 턴 내 모험가 처리 순서는 `플레이어 자유 선택`으로 고정합니다(슬롯 고정 순서 아님).
- 한 번 굴린 모험가는 반드시 먼저 소비(공격)해야 하며, 그 전에는 다른 모험가를 굴릴 수 없습니다.
- 현재 모험가 공격을 확정한 뒤 `Undo`는 허용하지 않습니다.
- `P4`에서 요구치 0 이하가 된 `Situation`은 즉시 성공 처리 후 보드에서 제거되며, 이후 페이즈에서 배치 대상으로 취급하지 않습니다.
- `P4` 공격 순서는 실제 드래그 공격 확정 순서를 따릅니다.
- `P4`에서 상황 성공으로 획득한 모든 것(골드/칙령/스킬 포함)은 같은 `P4`에서 즉시 사용 가능합니다.
- 턴 종료 시점에 미소비 모험가가 있으면 경고 모달을 표시합니다.
- 경고 모달에서 플레이어가 "그대로 종료"를 선택하면 턴 진행을 허용합니다.

### 모험가 처리 UX 규칙(확정)

- 레이아웃은 상-하 분리 구도:
  - 상단 중앙: `Situation` 카드 영역
  - 하단 중앙: `Adventurer` 카드 영역
  - 상단 HUD/하단 액션바와 겹치지 않도록 고정 여백을 유지
- 모험가별 `굴리기` 버튼과 단축키 `1/2/3/4`를 모두 지원합니다.
- `1/2/3/4` 단축키는 하단 중앙 모험가 슬롯(좌->우)과 고정 매핑합니다.
- 모험가가 굴려진 직후에는 해당 모험가 외 나머지 굴리기 입력을 비활성화합니다.
- 비활성화된 롤 키 입력은 별도 경고 연출 없이 무시합니다.
- 공격 입력은 `드래그 전용`으로 제한합니다.
- 드래그 중에는 연결 라인이 대상까지 늘어나는 방식으로 표시합니다.
- 모험가를 드래그해 `빈 공간`에 드롭하면 드래그만 취소되고, 해당 모험가의 처리 상태는 유지됩니다.
- 모바일 UI는 v0 범위에서 고려하지 않습니다(데스크톱 우선).
- 턴 종료 시 미처리 모험가가 남아 있으면 경고 모달을 표시하고, 플레이어가 확인하면 강행 종료를 허용합니다.
- 정산/발동 연출은 기본값을 짧게 유지하고, `빠르게 진행` 옵션을 제공합니다.

### 골드 저점 규칙(확정)

- 골드는 기본적으로 음수를 허용하지 않습니다.
- 골드는 `최소값(min floor)` 개념을 가지며, 기본 저점은 0입니다.
- 특정 효과(예: 은행형 구조물)는 저점을 일시적으로 음수 구간으로 변경할 수 있습니다.
- `min floor`는 "해당 골드가 내려갈 수 있는 최저선"을 뜻합니다.
- `min floor` 변경 효과가 여러 개일 경우 변화량을 합산합니다.
  - 예: 기본 0, 효과 A(-10), 효과 B(+2) -> 최종 `min floor` = -8

### 실패 효과 처리 순서(확정)

- `P5 Settlement`의 상황 실패 효과는 합산 처리하지 않고 순차 처리합니다.
- 적용 순서는 매 턴 UI 보드 정렬 순서(좌 -> 우, 상 -> 하)로 고정합니다.
- 같은 순서를 실패 로그 UI에도 그대로 표시해 예측 가능성을 유지합니다.

## 턴 파워 예산 vs 위협 예산 변수 프레임(진행중)

- 턴 파워 예산 `P_turn`은 아래 합으로 관리합니다.
  - `P_dice`: 이번 턴 리필 주사위로 즉시 생성 가능한 파워
  - `P_skill_free`: 이번 턴 사용 가능한 무료 Skill 파워
  - `P_skill_paid`: 골드 비용을 지불해 전환 가능한 Skill 파워
  - `P_item`: 이번 턴 사용 가능한 Decree 파워
- 위협 예산 `T_turn`은 아래 합으로 관리합니다.
  - `T_now`: 현재 보드 상황 요구치 총량
  - `T_deadline`: 기한 압박으로 인한 가중 위협
  - `T_failure`: 기한 만료 시 실패 효과 기대 손실
- 목표 상태:
  - 평균 상황에서는 `P_turn`으로 전부 해결이 아닌 "선택적 해결"이 발생해야 함
  - 고위험 턴에서는 비용형 Skill/Decree로 `P_skill_paid`, `P_item`을 동원해 위기 탈출 가능해야 함
  - 무쿨다운+무비용 조합으로 무한 보정 루프가 생기지 않아야 함
  - Decree 폭발 턴은 허용하되, 상시 재현 가능한 기본 전략이 되지 않도록 희소성/공급량을 관리해야 함

### 예산 평가 우선순위(확정)

- 1순위는 `평균 기대값` 기반으로 파워/위협 균형을 맞춥니다.
- 하한 안전값은 "재시작 접근성"과 "칙령(Decree) 윤활 장치"로 보완합니다.

## 예시 진행(문서화)

- 초기 상태
  - 주사위 4개(기본 3, 2회 굴림 후 높은 눈 채택 강화 1)
  - 스킬: 리롤(CD1), 눈 +1(CD1), 상황 요구치 -2(CD2)
  - 구조물: 이번 턴 최저 눈 +1
- 보드 상황
  - `오크 부대`(침략): 요구치 20, 기한 1, 실패 효과 안정도 -2, 성공 보상 골드 +3
  - `메뚜기 떼`(기근): 요구치 17, 기한 2, 실패 효과 안정도 -1, 성공 보상 안정도 +1
- 배치/굴림 결과
  - 오크 부대에 모험가 배치 -> 공격 합계 9
  - 메뚜기 떼에 모험가 배치 -> 공격 합계 6
- 판정
  - 오크 부대 요구치 11, 메뚜기 떼 요구치 11이 남음
  - `P5`에서 기한 감소 후 오크 부대가 실패 처리되어 실패 효과가 발동하고 보드에서 제거됨
  - 다음 턴에는 메뚜기 떼(요구치 11, 남은 기한 1)에 집중할지, 신규 생성 상황과 우선순위를 재판단

## 밸런스 기준(초안)

- 판단 강도: 매 턴 "모든 문제 해결"이 아니라 "무엇을 포기할지"를 결정하게 설계
- 시너지 가치: 단일 고성능 옵션보다 조합(주사위 강화 + 스킬 + 구조물)이 더 강하도록 설계
- 리스크 관리: 단기 손해를 감수해 장기 성장(구조물/강화)을 선택할 여지를 보장

### 수치 확정 게이트

- 아래 핵심 파라미터가 확정되기 전에는, 신규 아이디어는 수치보다 기믹/상호작용/트레이드오프 중심으로 기록합니다.
  - 스타팅 주사위 수 및 성장 속도
  - 턴당 평균 상황 수/난이도 곡선
  - 스킬/구조물/칙령의 평균 파워 예산

## 아이디어 밸런스 체크리스트(리뷰 기준)

- 전력 곡선: 초반/중반/후반 중 특정 구간만 과도하게 강해지지 않는가
- 선택 다양성: 특정 조합이 사실상 강제되어 빌드 다양성을 해치지 않는가
- 상호작용 리스크: 리롤/배수/오버킬 등과 결합 시 무한 이득 루프가 생기지 않는가
- 실패 허용성: 실수 1회가 즉시 런 파괴로 이어져 복구 불가능해지지 않는가
- 보상 적정성: 난이도 대비 보상이 과소/과대하지 않은가

### 밸런스 판정 라벨

- `오버밸런스`: 평균적인 선택 대비 기대값이 지나치게 높고, 사실상 필수 선택이 되는 상태
- `언더밸런스`: 사용 조건/리스크 대비 기대값이 낮아 선택 동기가 부족한 상태
- `중립(조건부)`: 특정 조건에서만 강하고, 명확한 대가/제약이 있는 상태

## 미해결 설계 질문

- 스테이지 단위 구조를 2차 실험으로 전환할 조건/시점 확정
- 2차 사이클 난이도 상승 규칙(턴당 생성, 요구치 증가, 기한 압박 중 무엇을 축으로 올릴지)
- 상황 생성 풀의 실제 구성안 확정(상황 조합/기한 압박 분포)
- 상황 다양성 확보를 위한 추가 상황 `2`종 컨셉/역할 확정
- 오버킬 처리 방식(남는 수치 이월 여부 + 오버킬 트리거/보상 규칙)
- 은행형 대출 한도(`N`) 값 확정

## 관련 문서

- 공통 규칙: `Docs/GENERAL_RULES.md`
- 레포 지도: `Docs/PROJECT_MAP.md`
- 아이디어 백로그: `Docs/GAME_IDEA_BACKLOG.md`
- 상황 로스터: `Docs/ENEMY_ROSTER.md`

