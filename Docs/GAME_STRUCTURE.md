# 게임 구조

이 문서는 DiceyKingdom의 게임 구조/시스템/런타임 흐름을 정리합니다. 레포 지도는 `Docs/PROJECT_MAP.md`, 범용 규칙은 `Docs/GENERAL_RULES.md`를 참고합니다.

## 문서 범위/분리 기준

- 범용 규칙/컨벤션: `Docs/GENERAL_RULES.md`
- 레포 지도(파일 위치/책임 요약): `Docs/PROJECT_MAP.md`
- 아이디어 원문/백로그: `Docs/GAME_IDEA_BACKLOG.md`
- v0 마일스톤 추적: `Docs/V0_MILESTONE.md`
- 몬스터 컨셉/대응 요약: `Docs/ENEMY_ROSTER.md`
- 이 문서: 실제 구현 기준이 되는 게임 구조, 시스템, 데이터/씬 흐름

## 프로덕트 요약 (한 줄)

- 2D 판타지 왕국의 왕이 되어, 매 턴 주사위를 분배해 위기를 관리하는 턴제 로그라이크 경영 게임.

## 현재 개발 단계(중요)

- 기준일: 2026-02-09
- 현재 최우선 목표는 "완성 기획 고정"이 아니라 "핵심 컨셉 검증용 플레이어블 v0 빌드" 제작입니다.
- 핵심 검증 가설:
  - 결과가 불확실한 자원을 분배하는 행위 자체가 반복 플레이에서 재미를 제공하는가
- 1차 검증 기준(확정):
  - 플레이 중/종료 후 "재미 신호"가 명확하게 감지되는가
  - 약 `10`회 플레이에서도 재미 신호가 거의 없으면 아이디어를 중단 후보로 판정
- v0 가드레일(확정):
  - 분배 단위를 모험가로 실험할 경우, 단위 수는 `4`로 고정
  - 스킬 최소 세트 3종을 기본 보유로 시작
    - 원하는 모험가 리롤(쿨다운 `1`)
    - 원하는 주사위 눈 +1(쿨다운 `1`)
    - 지정 몬스터에 피해 2(쿨다운 `2`)
  - 모든 스킬은 개별 쿨다운을 가지며, 각 스킬은 턴당 `1`회만 사용 가능
  - 검증 초점은 "모험가 <-> 스킬 시너지의 재미 체감"으로 둠
- 실험 전략(확정):
  - `선택지 A` 적용: 분배 단위만 모험가로 전환하고, 진행 구조는 기존 연속 누적 턴 보드를 유지
  - 이번 사이클에서는 단일 빌드로 플레이테스트 수행
  - 스테이지 단위 + 준비시간 액션 구조는 차기 사이클 후보로 보류
  - 세션 평가는 코드 로그가 아닌 플레이어 수동 피드백으로 진행
- 문서 내 기존 세부 규칙/수치/용어는 참고 베이스라인이며, v0 결과에 따라 구조적 변경(예: 분배 단위/보드 구조) 가능성이 열려 있습니다.
- 충돌 시 우선순위:
  - v0 검증 목표 > 기존 상세 규칙

### v0 구현 범위(확정)

- 포함:
  - 분배 단위를 모험가로 전환
  - 모험가 수 `4` 고정
  - 스킬 3종 기본 보유(리롤 CD1, 눈 +1 CD1, 몬스터 피해 2 CD2)
  - 스킬 규칙: 개별 쿨다운 + 각 턴당 스킬별 1회 사용
  - 전투 계산: 몬스터는 체력(HP)을 가지며, 모험가 주사위 눈 합으로 공격해 체력을 감소
  - 기존 연속 누적 턴 보드 구조 유지
  - 런 종료 조건 `Stability <= 0`
- 제외:
  - 스테이지 단위 + 준비시간 액션 구조
  - 모험가 수 증가(4->5->6)
  - 확장 성장 시스템/경제 확장/메타 진행
  - 런 종료 설문/자동 로그 수집 기능

### v0 런 파라미터 잠금(확정)

- 초기 안정도(`Stability`)는 `20`으로 고정합니다.
- 초기 골드(`Gold`)는 `0`으로 고정합니다.
- v0 몬스터 스테이지 프리셋 풀은 `3`개로 고정합니다.
- 프리셋은 런타임 생성이 아니라 `사전 제작(prebuilt)` 방식으로 관리합니다.
- 각 프리셋은 `동일 위협 예산`을 사용합니다.
- 런 시작 시 프리셋 `3`개 중 무작위 `1`개를 선택해 몬스터를 즉시 배치합니다.
- 턴당 신규 몬스터 생성 수는 `0`으로 고정합니다.
- 보드에 몬스터가 `0`마리(전멸)인 상태가 되면, 다음 `P1 BoardUpdate`에서 프리셋 `3`개 중 무작위 `1`개를 다시 소환합니다.
- 보드 최대 몬스터 수 상한은 두지 않습니다.
- 프리셋 데이터 소스는 `EnemyStagePresets.json`으로 고정합니다.

### v0 구현 순서

1. 모험가 최소 데이터 스키마 정의(굴림 주사위 수, 고유 효과, 장비 슬롯)
2. 모험가 배치/전투 루프 신규 구현(템플릿 기본 코드만 존재하므로 치환 작업 없음)
3. 스킬 3종 효과 구현(리롤, 눈 +1, 몬스터 피해 2)
4. 스킬 사용 UI/피드백 구현(선택 대상 표시, 사용 가능/쿨다운 상태 표시)
5. 연속 턴 보드에서 몬스터 체력 정산이 모험가 체계와 맞물리도록 연결
6. 플레이 가능한 빌드 완성 후 사용자 수동 플레이테스트 진행

## 게임 컨셉

- 플레이어는 왕국의 군주로서 매 턴 주사위를 굴리고, 보드에 쌓이는 몬스터를 대응하며 왕국을 생존시킵니다.
- 핵심 생존 자원은 `안정도`이며, 안정도가 0 이하가 되면 즉시 게임 오버입니다.
- `V1` 진행 목표는 엔딩형이 아닌 생존형(얼마나 오래 버티는지)으로 고정합니다.

## 런 목표(V1 확정)

- `V1` 런 목표는 생존형 1종만 사용합니다.
- 런 종료 조건은 `Stability <= 0`입니다.
- 보스/엔딩/특수 승리 조건은 `V2` 이후 확장 항목으로 분리합니다.

## 용어 사전(확정)

- `Situation` / `상황`
  - 보드에 생성되는 문제/기회 단위
- `Enemy` / `몬스터`
  - v0 전투 단위(체력을 가진 적)
- `Skill` / `스킬`
  - 액티브 능력 카테고리(인물 테마)
- `Structure` / `구조물`
  - 영구 패시브 카테고리(건물/시설 테마)
- `Decree` / `칙령`
  - 즉시 사용 소모성 수단
- `Stability` / `안정도`
  - 왕국 생존 자원(0 이하 시 게임 오버)
- `Gold` / `골드`
  - 런 내 공용 경제 통화
- `Health` / `체력`
  - 몬스터가 가지는 생명 수치
- `Attack` / `공격`
  - 모험가 주사위 눈의 합으로 생성되는 피해량
- `Tags` / `태그`
  - 상황/효과 분류 키워드(예: 침략, 기근)
- `Run` / `런`
  - 게임 1회 플레이 단위
- `Turn` / `턴`
  - 런 내 최소 진행 단위
- `Phase` / `페이즈`
  - 턴 내부 고정 단계

### 용어 사용 규칙(확정)

- 문서/코드/데이터/UI에서 같은 개념은 항상 동일 용어를 사용합니다.
- 한글 표기 우선, 영문은 괄호로 병기합니다.
- 기존 표현은 점진적으로 `스킬(Skill)`, `구조물(Structure)`, `칙령(Decree)` 기준으로 통일합니다.
- 경제 용어는 `재화` 대신 `골드(Gold)`를 기본 표기로 사용합니다.

## 디자인 철학(확정)

- 목표는 플레이어를 괴롭히는 것이 아니라, 도전적인 난이도에서 시너지 탐색/실험/실현의 성취감을 제공하는 것입니다.
- 난이도와 보상은 함께 설계하며, "어려움만 있고 보상이 없는 상태"를 피합니다.
- 소모품을 한 턴에 집중 사용해 폭발적인 결과를 만드는 플레이는 허용하되, 그 전제는 충분한 희소성과 기회비용입니다.
- 강력한 시너지는 만들기 어렵게 설계하고, 특정 고점 전략이 모든 상황에 통하지 않도록 카운터 기믹을 함께 배치합니다.
- 선택은 흥미로워야 하며, 과도한 복잡도로 인해 피로를 유발하는 설계는 지양합니다.
- 모든 효과는 "한 번 읽고 이해 가능한 단문 규칙"을 우선하며, 길고 조건이 많은 효과는 예외적으로만 허용합니다.

## 씬/런타임 흐름

- `Bootstrap` -> `MainMenu` -> `RunScene` 진입
- `RunScene`에서 단일 런이 진행되며, 턴 단위로 몬스터 행동/공격/정산을 반복
- 런 종료 조건: 안정도 0 이하

## 핵심 루프

1. 턴 시작
2. 몬스터 보드 갱신(지속 효과 갱신, 보드 전멸 시 다음 스테이지 프리셋 랜덤 소환)
3. 모험가 배치(몬스터 단위 할당)
4. 주사위 굴림
5. 스킬/칙령 보정 후 몬스터 체력 감소(처치 시 보상 즉시 지급)
6. 턴 종료 정산(생존 몬스터 행동 카운트 감소, 행동 발동 효과 적용, 안정도 증감)
7. 다음 턴 반복

## 데이터 로딩

- 템플릿은 `SaCache` + `StaticDataManager` 기반의 JSON 로딩 흐름을 제공합니다.
- 프로젝트 초안 데이터 테이블:
  - `Enemies.json`: Enemy 정의(기존 `Situations.json` 대체)
  - `EnemyStagePresets.json`: 사전 제작된 몬스터 스테이지 프리셋 정의
  - `DiceBuffs.json`: 주사위 강화 정의
  - `Skills.json`: Skill 정의
  - `Legacies.json`: Structure 정의
  - `Consumables.json`: Decree 정의

## 저장/로드

- 템플릿은 `SaveService` 기반의 일반 저장/로드 유틸을 제공합니다.
- 런타임 저장 스키마 초안:
  - 현재 턴 수
  - 현재 안정도/최대 안정도
  - 보유 주사위/강화 상태
  - 보유 스킬/쿨다운 상태
  - 보유 구조물
  - 보드 위 몬스터 상태(현재 체력/현재 행동/행동 준비 카운트/배치된 모험가)
  - 경제 값(골드)

## UI/UX 공용 시스템

- 모달/토스트/툴팁/플로팅 텍스트는 공용 UI 유틸로 제공됩니다.
- 런 보드 UI 요구사항 초안:
  - 몬스터 카드별 태그, 체력, 현재 행동, 행동 준비 카운트, 처치 보상 표시
  - 모험가 배치 가능/불가 상태 가시화
  - 스킬 쿨다운 및 사용 가능 조건 표시
  - `P4` 종료 시 미배치 모험가 경고 모달 표시
  - 안정도 변화 로그 표시

## 오디오

- `AudioManager`(SFX), `BgmManager`(BGM) 공용 유틸 제공.

## 난수

- 주사위 굴림은 `System.Random` 기반으로 처리합니다.
- 재현성(디버깅/시드 런)이 필요하므로 런 시작 시 시드를 저장합니다.

## 텍스트 스타일(프로젝트별)

- 기준: `Assets/GlobalTextStyles.asset`
- TODO: 프로젝트 스타일 이름 확정 후 반영

## 핵심 시스템 규칙(초안)

### 안정도
- 왕국의 체력 역할을 수행합니다.
- 상황 실패, 디버프, 이벤트 등에 의해 감소합니다.
- 보상, 유산, 고정 행동(예: 영지 순찰) 등으로 회복할 수 있습니다.

### 주사위
- 매 턴 플레이어는 보유한 주사위를 굴립니다.
- 기본 주사위 눈 범위는 1~6입니다.
- 각 주사위는 강화 1개를 장착할 수 있습니다.
- 강화 예시:
  - 모든 눈 +1
  - 최소 1회 리롤 보장
  - 2회 굴림 후 높은 눈 채택

### 모험가(Adventurer)

- 모험가는 플레이어가 턴마다 몬스터에 배치하는 전투 단위입니다.
- 각 모험가는 자신의 주사위를 굴려 `공격` 값을 생성합니다.
- 한 턴에 한 모험가는 하나의 몬스터에만 배치할 수 있습니다.

### 모험가 최소 스키마(v0 확정)

- 정적 데이터(`AdventurerDef`):
  - `adventurer_id`: string (고유 ID)
  - `name_key`: string (로컬라이즈 키)
  - `dice_count`: int (`>= 1`)
  - `gear_slot_count`: int (`>= 0`)
  - `innate_effect`: effect_bundle or null (고유 패시브/전투 효과)
- 런타임 데이터(`AdventurerState`):
  - `instance_id`: string (런 내 모험가 인스턴스 ID)
  - `adventurer_def_id`: string (`AdventurerDef.adventurer_id` 참조)
  - `rolled_dice_values`: int[] (`P3` 결과값)
  - `assigned_enemy_instance_id`: string or null (`P2` 배치 대상)
  - `action_consumed`: bool (`P4`에서 공격 반영 완료 여부)
- v0 처리 규칙:
  - 런 시작 시 모험가 슬롯은 `4`개로 고정합니다.
  - 각 모험가는 `dice_count`만큼 기본 d6(1~6)을 굴립니다.
  - `P2`에서 배치되지 않은 모험가는 `P4`에서 공격에 기여하지 않습니다.
  - `P4`에서 모험가의 공격 반영이 끝나면 `action_consumed = true`로 확정합니다.
  - 턴 종료 시 모험가 배치/굴림/소비 상태는 다음 턴 시작에 리셋됩니다.

### 몬스터(Enemy, 기존 Situation)
- 몬스터는 `태그`, `체력(Health)`, `행동(Action)`, `처치 보상`을 가집니다.
- 모험가가 굴린 주사위 눈 합은 해당 몬스터의 `체력`을 감소시키는 `공격`으로 적용됩니다.
- 몬스터 체력이 0 이하가 되면 즉시 처치 처리합니다.
- `deadline` 개념은 사용하지 않고, 몬스터 행동의 준비 카운트/발동으로 위협을 표현합니다.

### 몬스터 최소 스키마(v0 확정)

- 정적 데이터(`EnemyDef`):
  - `enemy_id`: string (고유 ID)
  - `name_key`: string (로컬라이즈 키)
  - `tags`: string[] (예: `invasion`, `famine`)
  - `base_health`: int (`>= 1`)
  - `on_kill_reward`: effect_bundle (처치 보상 효과)
  - `action_pool`: action_def[]
    - `action_id`: string
    - `weight`: int (`>= 1`)
    - `prep_turns`: int (`>= 1`)
    - `on_resolve`: effect_bundle (행동 발동 효과)
- 런타임 데이터(`EnemyState`):
  - `instance_id`: string (보드 인스턴스 ID)
  - `enemy_def_id`: string (`EnemyDef.enemy_id` 참조)
  - `current_health`: int
  - `current_action_id`: string
  - `action_turns_left`: int
  - `assigned_adventurer_ids`: string[] (`P2` 확정 배치)
- v0 처리 규칙:
  - 스폰 시 `current_health = base_health`, `action_pool`에서 현재 행동 1개를 선택합니다.
  - 행동 선택 직후 `current_action_id`를 설정하고, `action_turns_left = prep_turns`로 시작합니다.
  - `P4`에서 `current_health <= 0`이면 즉시 처치 + 보상 지급 후 보드에서 제거합니다.
  - `P5`에서 생존 몬스터의 `action_turns_left -= 1`을 적용합니다.
  - 감소 후 `action_turns_left <= 0`이면 `current_action_id.on_resolve`를 즉시 적용합니다.
  - 행동 발동 후에는 `action_pool`에서 다음 행동을 다시 선택하고 준비 카운트를 재설정합니다.

### action_pool 상세 규칙(v0 확정)

- `action_pool` 길이는 몬스터당 정확히 `2`개로 고정합니다.
- 각 액션의 `action_id`는 같은 몬스터 내에서 유일해야 합니다.
- `weight`는 `1..5` 정수만 허용합니다.
- `prep_turns`는 `1..2` 정수만 허용합니다.
- 각 몬스터는 아래를 모두 만족해야 합니다.
  - `prep_turns = 1` 액션 최소 1개
  - `prep_turns = 2` 액션 최소 1개
- 행동 선택 시점은 2곳만 허용합니다.
  - 스폰 직후
  - 행동 발동 직후(다음 행동 예약)
- 선택 방식은 `weight` 기반 가중 랜덤입니다.
- 연속 반복 규칙:
  - 직전 행동과 동일 `action_id`는 다음 선택에서 제외합니다(후보가 2개 이상일 때).
- 유효성 검증 실패 시(길이/범위/중복 위반) 해당 정의는 데이터 로딩 단계에서 에러로 처리합니다.

### 범용 효과 스키마(v0 확정)

- 효과 포맷은 참조형이 아니라 `범용형(effect_bundle)`으로 고정합니다.
- `effect_bundle`:
  - `effects`: effect_spec[]
- `effect_spec`(JSON, snake_case):
  - `effect_type`: string (필수)
  - `value`: number or null
  - `params`: object or null
- 부호 규칙:
  - 증가는 양수, 감소는 음수로 통일합니다.
- v0 최소 지원 `effect_type`:
  - `stability_delta`
  - `gold_delta`
  - `enemy_health_delta`
  - `die_face_delta`
  - `reroll_adventurer_dice`
- `effect_type`별 `params` 필수 키 규칙(v0 확정):
  - `stability_delta`
    - 필수 키 없음 (`params = null`)
  - `gold_delta`
    - 필수 키 없음 (`params = null`)
  - `enemy_health_delta`
    - 필수: `target_mode`
    - 허용값: `selected_enemy` | `action_owner_enemy`
  - `die_face_delta`
    - 필수: `target_adventurer_mode`, `die_pick_rule`
    - 허용값:
      - `target_adventurer_mode`: `selected_adventurer`
      - `die_pick_rule`: `selected` | `lowest` | `highest` | `all`
  - `reroll_adventurer_dice`
    - 필수: `target_adventurer_mode`, `reroll_rule`
    - 허용값:
      - `target_adventurer_mode`: `selected_adventurer`
      - `reroll_rule`: `all` | `single`

### 스킬(Skill)
- 액티브 능력으로 턴 쿨다운을 가집니다.
- 주사위 재굴림, 눈 보정, 즉시 피해 등 전술적 보정을 담당합니다.
- 일부 스킬은 대상 몬스터당 사용 횟수 제한을 가질 수 있습니다.
- 쿨다운이 0이 되면 해당 턴에 즉시 사용 가능합니다.

### 구조물(Structure)
- 런 동안 유지되는 영구 패시브입니다.
- 빌드 방향성과 장기 성능을 결정하는 핵심 성장 축입니다.
- 테마는 건물/시설/설치물 방향으로 고정합니다.

### 칙령(Decree)
- 특정 태그/상황에 강한 즉시 사용형 카드입니다.
- 연출 테마는 칙령/문서류(소모성 정책 발동) 방향을 기본안으로 둡니다.
- 포지션은 "위기 대응용 윤활유"이며, 희소 공급 + 구매 기회비용을 통해 상시 정답 전략화를 방지합니다.

## 턴 처리 규칙(부분 확정)

1. 턴 시작: 보드 상태를 갱신합니다(보드 전멸 시 다음 스테이지 프리셋을 추가합니다).
2. 배치 단계: 플레이어가 모험가를 `Enemy` 단위로 할당합니다.
3. 굴림 단계: 할당 주사위를 굴려 결과를 생성합니다.
4. 보정/해결 단계:
   - 스킬/칙령으로 결과를 보정합니다.
   - 모험가가 생성한 공격으로 몬스터 체력을 감소시킵니다.
   - 몬스터 체력이 0 이하가 되면 즉시 처치 처리되며, 보상도 즉시 지급됩니다.
5. 종료 정산(생존 몬스터만 대상):
   - 생존 몬스터의 행동 준비 카운트를 감소시킵니다.
   - 준비 카운트가 0 이하가 된 몬스터는 현재 행동 효과를 즉시 발동합니다.
   - 행동 발동 후 다음 행동을 선택하고 준비 카운트를 재설정합니다.
6. 안정도 0 이하 여부를 판정합니다.

### 턴 최소 사이클 단위(상태머신 부분 확정)

- 용어 정의
  - `Phase`: 턴을 구성하는 고정 단계
  - `Window`: 플레이어가 스킬/칙령 등 능동 효과를 사용할 수 있는 구간
  - `Commit`: 해당 단계 결과가 확정되어 되돌릴 수 없는 지점
- 사이클 정의
  - `P0 TurnStart`
    - 주사위 리필, 스킬 쿨다운 감소, 턴 시작 트리거 처리
    - `Commit`: 리필/쿨다운 결과 확정
- `P1 BoardUpdate`
    - 보드 상태 갱신(턴 시작형 지속효과 포함)
    - 보드 전멸 상태면 사전 제작된 프리셋 `3`개 중 무작위 `1`개를 선택해 몬스터를 소환
    - 턴 기반 정기 생성은 없음(턴당 생성 수 `0`)
    - `Commit`: 이번 턴 보드 구성 확정
  - `P2 Assignment`
    - 플레이어가 모험가를 `Enemy` 단위로 배치
    - `Window`: 스킬/칙령 사용 가능
    - `Commit`: 모험가-몬스터 귀속 확정
  - `P3 Roll`
    - 배치된 주사위를 굴려 결과 생성
    - `Commit`: 원시 굴림값 확정
  - `P4 Adjustment`
    - 굴림값/몬스터 상태를 보정하는 효과 처리
    - `Window`: 스킬/칙령 사용 가능
    - 모험가 공격으로 몬스터 체력을 감소
    - 몬스터 체력 0 이하 시 즉시 `처치` + 보상 즉시 지급
    - `Commit`: 최종 적용값 및 P4 내 즉시 보상 결과 확정
  - `P5 Settlement`
    - 내부 순서:
      1. `생존` 몬스터의 행동 준비 카운트 1 감소
      2. 준비 카운트 0 이하 몬스터의 현재 행동 효과 발동
      3. 행동 효과를 보드 고정 순서로 순차 적용
      4. 발동 완료 몬스터의 다음 행동 선택 및 카운트 재설정
    - `Commit`: 턴 결과 확정
  - `P6 EndTurn`
    - 턴 종료형 지속효과 처리, 게임오버 판정
    - 다음 턴으로 이행

### 턴 시작 리필 규칙(확정)

- 플레이어 보유 주사위는 턴 시작 시 전부 리필됩니다.
- 플레이어 보유 스킬의 쿨다운은 턴 시작 시 감소합니다.
- 쿨다운이 0이 된 스킬은 같은 턴에 즉시 사용 가능합니다.

### 스킬/칙령 사용 규칙(확정)

- 모든 스킬은 개별 쿨다운을 가집니다.
- 각 스킬은 턴당 `1`회만 사용 가능합니다.
- 이는 "최대 사용 가능 횟수" 제한이며, 매 턴 반드시 사용해야 한다는 뜻은 아닙니다.
- v0 스킬 쿨다운 값:
  - 원하는 모험가 리롤: `1`
  - 원하는 주사위 눈 +1: `1`
  - 지정 몬스터 피해 2: `2`
- 턴당 소모품 사용 횟수 제한은 없습니다.
- 효과 비용은 대부분 무료를 기본값으로 보되, 일부 스킬/칙령은 골드 비용을 가질 수 있습니다.
- 사용 윈도우는 `P2 Assignment`, `P4 Adjustment`로 제한합니다.
- `P3 Roll` 및 `P5 Settlement` 이후에는 스킬/칙령을 사용할 수 없습니다.
- 비용이 있는 효과는 항상 사용 전에 비용을 지불합니다.
- 골드가 부족하면 해당 효과는 사용할 수 없습니다.
- 사용 가능/불가 상태는 UI에서 즉시 식별 가능해야 합니다.
- 소모품은 턴당 제한이 아니라 보유량 한도로 관리합니다.
- v0에서는 무쿨다운 스킬을 사용하지 않습니다.

### 모험가 배치/소비 규칙(확정)

- `P2 Assignment`에서는 모험가를 `Enemy`에만 배치합니다.
- v0에서는 `롤 후 할당` 방식을 사용하지 않고, `사전 할당 -> 롤 -> 조정` 순서를 유지합니다.
- `P2`에서 배치된 모험가는 `P4`에서 같은 `Enemy`를 공격하는 데만 사용할 수 있습니다.
- 기본 규칙으로는 `Enemy` 간 모험가 이동/재배치를 허용하지 않습니다.
- 예외적으로, 명시된 스킬/칙령 효과가 있을 때만 `Enemy` 간 이동/교환을 허용합니다.
- `P4`에서 몬스터를 처치해 획득한 모든 것(골드/칙령/스킬 포함)은 같은 `P4`에서 즉시 사용 가능합니다.
- `P4` 종료 시점에 미배치 모험가가 있고 합법적 배치 대상이 1개 이상 남아 있으면 경고 모달을 표시하고, 플레이어 확인 후에만 종료할 수 있습니다.

### 골드 저점 규칙(확정)

- 골드는 기본적으로 음수를 허용하지 않습니다.
- 골드는 `최소값(min floor)` 개념을 가지며, 기본 저점은 0입니다.
- 특정 효과(예: 은행형 구조물)는 저점을 일시적으로 음수 구간으로 변경할 수 있습니다.
- `min floor`는 "해당 골드가 내려갈 수 있는 최저선"을 뜻합니다.
- `min floor` 변경 효과가 여러 개일 경우 변화량을 합산합니다.
  - 예: 기본 0, 효과 A(-10), 효과 B(+2) -> 최종 `min floor` = -8

### 행동 효과 처리 순서(확정)

- `P5 Settlement`의 몬스터 행동 효과는 합산 처리하지 않고 순차 처리합니다.
- 적용 순서는 매 턴 UI 보드 정렬 순서(좌 -> 우, 상 -> 하)로 고정합니다.
- 같은 순서를 행동 큐 UI/로그에도 그대로 표시해 예측 가능성을 유지합니다.

## 턴 파워 예산 vs 위협 예산 변수 프레임(진행중)

- 턴 파워 예산 `P_turn`은 아래 합으로 관리합니다.
  - `P_dice`: 이번 턴 리필 주사위로 즉시 생성 가능한 파워
  - `P_skill_free`: 이번 턴 사용 가능한 무료 Skill 파워
  - `P_skill_paid`: 골드 비용을 지불해 전환 가능한 Skill 파워
  - `P_item`: 이번 턴 사용 가능한 Decree 파워
- 위협 예산 `T_turn`은 아래 합으로 관리합니다.
  - `T_now`: 현재 보드 몬스터 체력 총량
  - `T_action`: 행동 준비 카운트 압박으로 인한 가중 위협
  - `T_resolve`: 행동 발동 시 즉시/지속 페널티 기대 손실
- 목표 상태:
  - 평균 상황에서는 `P_turn`으로 전부 해결이 아닌 "선택적 해결"이 발생해야 함
  - 고위험 턴에서는 비용형 Skill/Decree로 `P_skill_paid`, `P_item`을 동원해 위기 탈출 가능해야 함
  - 무쿨다운+무비용 조합으로 무한 보정 루프가 생기지 않아야 함
  - Decree 폭발 턴은 허용하되, 상시 재현 가능한 기본 전략이 되지 않도록 희소성/공급량을 관리해야 함

### 예산 평가 우선순위(확정)

- 1순위는 `평균 기대값` 기반으로 파워/위협 균형을 맞춥니다.
- 하한 안전값은 "재시작 접근성"과 "칙령(Decree) 윤활 장치"로 보완합니다.

## 예시 진행(문서화)

- 초기 상태
  - 주사위 4개(기본 3, 2회 굴림 후 높은 눈 채택 강화 1)
  - 스킬: 리롤(CD1), 눈 +1(CD1), 몬스터 피해 2(CD2)
  - 구조물: 이번 턴 최저 눈 +1
- 보드 상황
  - `오크 부대`(침략): 체력 10, 현재 행동 `강습`(준비 1, 안정도 -2)
  - `메뚜기 떼`(기근): 체력 8, 현재 행동 `황폐화`(준비 2, 기근 관련 페널티)
- 배치/굴림 결과
  - 오크 부대에 모험가 배치 -> 공격 합계 9
  - 메뚜기 떼에 모험가 배치 -> 공격 합계 6
- 판정
  - 오크 부대 체력 1 남음, 메뚜기 떼 체력 2 남음
  - `P5`에서 오크 부대 행동이 발동(준비 1 -> 0)하고, 다음 행동을 다시 선택
  - 다음 턴에 잔여 체력(오크 1, 메뚜기 2)을 이어서 공략

## 밸런스 기준(초안)

- 판단 강도: 매 턴 "모든 문제 해결"이 아니라 "무엇을 포기할지"를 결정하게 설계
- 시너지 가치: 단일 고성능 옵션보다 조합(주사위 강화 + 스킬 + 구조물)이 더 강하도록 설계
- 리스크 관리: 단기 손해를 감수해 장기 성장(구조물/강화)을 선택할 여지를 보장

### 수치 확정 게이트

- 아래 핵심 파라미터가 확정되기 전에는, 신규 아이디어는 수치보다 기믹/상호작용/트레이드오프 중심으로 기록합니다.
  - 스타팅 주사위 수 및 성장 속도
  - 턴당 평균 몬스터 수/난이도 곡선
  - 스킬/구조물/칙령의 평균 파워 예산

## 아이디어 밸런스 체크리스트(리뷰 기준)

- 전력 곡선: 초반/중반/후반 중 특정 구간만 과도하게 강해지지 않는가
- 선택 다양성: 특정 조합이 사실상 강제되어 빌드 다양성을 해치지 않는가
- 상호작용 리스크: 리롤/배수/오버킬 등과 결합 시 무한 이득 루프가 생기지 않는가
- 실패 허용성: 실수 1회가 즉시 런 파괴로 이어져 복구 불가능해지지 않는가
- 보상 적정성: 난이도 대비 보상이 과소/과대하지 않은가

### 밸런스 판정 라벨

- `오버밸런스`: 평균적인 선택 대비 기대값이 지나치게 높고, 사실상 필수 선택이 되는 상태
- `언더밸런스`: 사용 조건/리스크 대비 기대값이 낮아 선택 동기가 부족한 상태
- `중립(조건부)`: 특정 조건에서만 강하고, 명확한 대가/제약이 있는 상태

## 미해결 설계 질문

- 스테이지 단위 구조를 2차 실험으로 전환할 조건/시점 확정
- 2차 사이클 난이도 상승 규칙(턴당 생성, 강화, 행동 압박 중 무엇을 축으로 올릴지)
- v0 프리셋 `3`개의 실제 구성안 확정(몬스터 조합/행동 압박 분포)
- 프리셋 다양성 확보를 위한 추가 몬스터 `2`종 컨셉/역할 확정
- 오버킬 처리 방식(남는 수치 이월 여부 + 오버킬 트리거/보상 규칙)
- 은행형 대출 한도(`N`) 값 확정

## 관련 문서

- 공통 규칙: `Docs/GENERAL_RULES.md`
- 레포 지도: `Docs/PROJECT_MAP.md`
- 아이디어 백로그: `Docs/GAME_IDEA_BACKLOG.md`
- 몬스터 로스터: `Docs/ENEMY_ROSTER.md`

