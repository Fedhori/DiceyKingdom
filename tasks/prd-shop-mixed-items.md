# PRD - 상점 혼합 상품(핀/토큰) 확장

## 1. 소개 / 개요
- 상점 상품을 핀/토큰 혼합 풀로 확장하고, 향후 다른 상품 타입도 쉽게 추가할 수 있는 구조를 도입한다.
- 슬롯 6개에 대해 각 슬롯별로 50% 확률로 핀 또는 토큰을 뽑아 노출한다. 추첨 후에는 타입별로 정렬해 보기 좋게 표시한다.
- 토큰은 중복 금지(플레이어 보유 + 로스터 내 중복), 핀은 기존 규칙 유지.

## 2. 목표
1. 공통 상품 모델/팩토리로 확장 가능한 상점 로스터 생성 파이프라인 구축.
2. 슬롯 6개, 슬롯별 50/50 핀/토큰 추첨, 타입별 정렬 UI 표시.
3. 토큰 중복 금지, 핀은 중복 허용.
4. 기존 리롤 규칙 공유(리롤 비용 증가 등).
5. 구매 UX: 선택/드래그 구매 지원, 선택 시 해당 슬롯 유형만 하이라이트.
6. 덱/보드 슬롯이 가득 찼을 때 구매를 막고 UI 갱신/로그 처리.

## 3. 사용자 스토리
- 플레이어: 상점에서 핀/토큰이 섞여 나오는 6개 상품을 보고, 선택 또는 드래그로 원하는 슬롯에 배치/구매한다.
- 디자이너/개발자: 상품 타입을 추가하거나 확률/슬롯 수를 조정하고, 중복 규칙(토큰 전용)을 유지한 채 쉽게 로스터를 재생성한다.
- QA: 리롤 시에도 중복 규칙이 지켜지고, 슬롯 가득 차 상태에서 구매가 막히며 UI가 일관되게 동작하는지 확인한다.

## 4. 기능 요구사항
1) 로스터 생성
   - 슬롯 수: 6개 고정(추후 확장 가능하도록 상수/설정화).
   - 각 슬롯은 독립적으로 50% 확률로 핀 또는 토큰을 선택.
   - 토큰 선택 시: 토큰 중복 금지(플레이어 보유 + 현재 로스터 내). 조건을 만족하는 토큰이 부족하면 빈 자리는 다른 상품(동일 확률 규칙)에 재추첨한다.
   - 핀 선택 시: 기존 핀 풀/가격/로캘 활용, 중복 허용.
   - 추첨 완료 후: 상품 타입 enum 순서대로 정렬해 UI에 표시.

2) 리롤/갱신
   - 핀 상점과 동일한 리롤 비용/증가 규칙을 공용으로 적용.
   - 리롤 시 동일한 50/50 규칙 + 토큰 중복 금지 규칙을 유지.

3) 구매 UX
   - 상품 선택 시: 해당 타입의 슬롯만 하이라이트(토큰 → 토큰 덱 빈 슬롯, 핀 → 핀 기본 슬롯). 반대 타입 선택은 해제.
   - 드래그/클릭 구매 모두 지원. 토큰은 덱이 가득 차면 구매 불가 + UI 리프레시/로그, 핀은 기존 “기본 핀만 교체” 규칙 유지.
   - 구매 성공 시 로스터의 해당 상품은 “판매됨/비활성” 상태로 갱신.

4) 데이터/표시
   - 가격은 DTO의 `price`를 사용(`PinDto.price`, `TokenDto.price`).
   - 이름/설명은 기존 로캘 키 재사용(`pin.<id>.name`, `token.<id>.name`, 효과 설명 키 등).
   - 상품 모델/뷰를 공통화(인터페이스/베이스 클래스로 확장성 확보).

## 5. 비목표 / 범위 외
- 상점 UI 전체 리디자인, 애니메이션/연출 강화는 최소화.
- 새로운 통화/가격 체계 도입.
- 토큰 외의 추가 상품 타입 구현은 스코프 밖(확장 가능 구조만 준비).

## 6. 디자인/UX 고려
- 상품 리스트는 타입별 정렬 후 표시. 슬롯은 6개 고정.
- 선택/하이라이트: 토큰 선택 시 토큰 슬롯에 반투명 마스크 등 간단 강조, 핀 선택 시 핀 슬롯 강조. 선택 전환 시 반대 타입 하이라이트 해제.
- 드래그 고스트/슬롯 하이라이트는 기존 핀/토큰 드래그 UX에 맞춰 재사용.

## 7. 기술 고려
- 공통 상품 모델/팩토리/뷰: `IShopItem`(type: Pin/Token, id, price, icon, tooltip)을 정의하고, 핀/토큰 어댑터로 풀 생성.
- 로스터 생성기: 슬롯별 확률/중복 규칙 적용(토큰 중복 체크: 플레이어 보유 + 로스터 내).
- 정렬 후 UI 바인딩: 타입 우선순위 설정(예: 토큰→핀 또는 설정값).
- 기존 ShopManager와의 통합: 리롤/선택/구매 흐름을 공통 상품으로 처리, 기존 핀-only 로직을 분리/대체.
- 구매 처리: 토큰 덱 가득 시 실패, 핀은 기본 핀만 교체 규칙 재사용.

## 8. 성공 지표
- 리롤/갱신 시 슬롯 6개가 50/50 규칙과 토큰 중복 금지 규칙을 만족하며 생성된다.
- UI에 핀/토큰이 정렬되어 표시되고, 선택 시 해당 슬롯만 하이라이트된다.
- 드래그/클릭 구매가 정상 동작하며, 토큰 덱 가득/핀 기본 슬롯 미존재 시 구매가 거부되고 UI가 갱신된다.
- 리롤 비용/증가가 기존 규칙대로 작동한다.

## 9. 오픈 질문/가정
- 토큰 풀 부족 시 남는 슬롯은 비워두는 것으로 가정(핀으로 대체하지 않음). 다른 동작(핀 대체) 필요 여부?
- 타입별 정렬 순서(토큰→핀 or 핀→토큰) 선호 여부?
- 추가 상품 타입 도입 시: 타입별 확률을 설정값으로 두되 합은 100%가 되도록 관리(중복 규칙은 타입별로 추후 정의).
