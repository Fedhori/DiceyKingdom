# PRD: 라운드 시작 시 선택형 볼 스폰 지점

## Introduction / Overview
- 기존: 라운드 시작 시 볼이 (0,0) 고정 위치에서 즉시 스폰된다.
- 목표: 라운드 시작 시 플레이어가 3x3 월드 지점 중 하나를 터치/클릭해 스폰 위치를 선택하고, 선택 즉시 라운드를 시작하도록 변경한다. 각 지점에는 볼 아이콘이 알파 페이드로 점멸하며 선택 가능 상태를 안내한다.

## Goals
- 라운드 시작 대기 상태에서 3x3 스폰 지점을 월드에 표시하고 점멸 효과로 안내.
- 플레이어가 지점을 터치/클릭하면 즉시 라운드를 시작하며, 선택된 지점에서 기존 규칙(InitialBallCount, 희귀도 확률)대로 볼이 스폰된다.
- 지점 선택 전에는 BallManager 스폰을 대기시키고, 타임아웃 없이 플레이어 입력을 기다린다.
- 라운드 시작 시 모든 스폰 지점 오브젝트는 숨기거나 제거한다.
- 스폰 지점 선택 단계가 활성일 때 화면 상단에 안내 텍스트 UI를 표시한다(문구는 추후 지정 가능).

## User Stories
1. 플레이어로서, 라운드 시작 전 3x3 지점 중 하나를 선택해 내가 원하는 위치에서 볼이 내려오게 하고 싶다.
2. 플레이어로서, 선택 가능한 지점이 어디인지 알기 쉽게 점멸하는 볼 아이콘을 보고 싶다.
3. 플레이어로서, 지점을 터치/클릭하면 바로 라운드가 시작되길 원한다(추가 확인 UI 없음).

## Functional Requirements
1. 라운드 대기 상태에서 3x3 스폰 지점을 월드에 생성한다. 각 지점은 스프라이트로 표시되고 알파 페이드(부드러운 점멸)를 반복한다.
2. 3x3 그리드는 기존 핀 4x4 격자의 중앙 영역을 균등 분할해 배치한다. (예시: 핀 4x4 셀 간격을 dx, dy라 할 때, 스폰 그리드 중심은 핀 그리드 중심과 동일. 3x3 지점은 각 축을 2등분해 -dx, 0, +dx 등으로 배치 — 아래 “Spawn Grid Example” 참고.)
3. 터치/클릭 한 번으로 지점을 선택하면 즉시 라운드를 시작하고, 선택된 지점 좌표를 BallManager에 전달해 첫 스폰 위치로 사용한다. 선택 이후 스폰 지점 오브젝트는 모두 비활성화/제거한다.
4. BallManager는 선택된 시작 위치를 사용해 기존 볼 생성 로직(InitialBallCount, 희귀도 확률, 성장율 등)을 그대로 수행한다. 위치만 변경된다.
5. 선택 전에는 BallManager 스폰을 시작하지 않는다. 타임아웃 없이 입력을 기다린다. 멀티터치는 고려하지 않고 단일 클릭/터치만 처리한다.
6. 선택 후 추가 사운드/진동은 없다.
7. 스폰 지점 선택 단계가 활성화되면 화면 상단 텍스트 UI를 표시하고, 선택 완료(라운드 시작) 시 숨긴다.

## Non-Goals (Out of Scope)
- 핀/스테이지/점수/상점 등 다른 시스템 변경.
- 볼 스폰 개수/희귀도/점수 배율 변경.
- 타임아웃/자동 선택/다중 지점 선택 지원.

## Design Considerations
- 비주얼: 월드 스프라이트로 표시, 아이콘 색/이미지는 기존 볼 스프라이트를 활용. 알파 페이드 애니메이션(코루틴/머티리얼 등)으로 점멸.
- 배치: 핀 4x4 그리드 중심 기준 3x3 균등 분할. PinManager의 간격/센터 오프셋을 이용해 중앙 영역을 3등분하여 좌표 계산.
- 상호작용: 간단한 클릭/터치 처리(Physics2D Raycast/Collider2D). 멀티터치는 무시.
- 해제: 라운드 시작 시 스폰 지점 오브젝트를 즉시 제거 또는 비활성화.
- UI: 스폰 선택 단계에서만 상단 안내 텍스트 UI 활성화.

## Technical Considerations
- 상태: StageManager/FlowManager에 “스폰 지점 선택” 대기 상태를 추가하거나, 라운드 시작 요청 시 스폰 지점 UI를 띄운 뒤 선택 신호를 받아 BallManager.StartSpawning을 트리거.
- 데이터: 추가 데이터 필요 없음(핀 그리드 파라미터 사용). 스폰 지점 프리팹/스프라이트만 필요.
- 배치 계산: PinManager의 row/col, gap, centerOffset을 활용해 핀 그리드 중심과 셀 간격을 구한 뒤, 3x3 포인트를 균등 배치.
- 입력 처리: 각 스폰 지점에 Collider2D 부착 후 OnMouseDown/Pointer 핸들러 또는 전역 Raycast로 선택 처리.
- UI 토글: 상단 텍스트 UI GameObject를 참조해 스폰 선택 단계 진입 시 활성화, 선택 종료 시 비활성화.
- 성능: 9개 오브젝트, 알파 페이드 코루틴 9개 수준으로 부담 적음.

## Success Metrics
- 라운드 시작 전 3x3 지점이 표시되고 점멸하며, 클릭 시 즉시 라운드가 시작된다.
- 스폰된 볼이 선택 지점에서 떨어지며 기존 개수/희귀도/점수 로직에 변화 없음.
- 선택 전에는 스폰이 일어나지 않고 대기 상태를 유지한다.

## Open Questions
- 스폰 지점 예시 좌표를 확정해야 함(핀 4x4 격자 dx, dy를 기반으로 3x3 지점의 상대 오프셋 산출). “예시: pinGap=64, centerOffset=0이면 x,y ∈ {-64, 0, +64}, pinGap=160이면 {-160, 0, +160}” 방식으로 정의 예정. 확인 바랍니다.
- 스폰 지점 프리팹(스프라이트/머티리얼/알파 애니메이션) 신규 제작 필요. UI 색상/아이콘에 대한 선호가 있으면 알려주세요.

## Spawn Grid Example (예시)
- PinManager pinGap = G, centerOffset = (cx, cy), 핀 4x4 중심 = (cx, cy).
- 스폰 지점 좌표 = (cx + sx, cy + sy), sx, sy ∈ {-G, 0, +G}, 총 9개. (핀 4x4가 G 간격으로 배치되어 있으므로 중앙 영역을 동일 간격으로 3분할한 배치 예)
