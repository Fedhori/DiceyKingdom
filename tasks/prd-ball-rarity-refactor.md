# PRD: 볼 희귀도 기반 리팩터링

## Introduction / Overview
- 기존 볼 시스템이 id/데이터 파일(Balls.json) 기반으로 동작하고, 상점에서 볼을 판매하며 덱을 id-count로 관리한다.
- 목표: 볼을 특정 id 없이 희귀도 확률과 개수만으로 생성하는 구조로 단순화하고, Balls.json/상점 볼 판매/볼 데이터 기반 로직을 제거한다. 플레이어별 설정에 따라 라운드마다 정해진 개수의 볼이 희귀도 확률에 따라 생성되며, 희귀도에 따라 색상/점수 배율만 달라진다.

## Goals
- Balls.json 및 BallDto 의존성을 제거하고 런타임 희귀도 결정으로 전환.
- 플레이어별로 정의된 “희귀도 확률” + “라운드당 볼 개수”를 기준으로 라운드 시작 시 볼 생성.
- 희귀도별 색상과 점수 배율(기본 1/2/4/8/16, 가변 적용 가능)을 적용해 플레이 경험을 유지.
- 상점에서 볼 관련 UI/로직을 제거하고 핀 관련 상점만 유지.

## User Stories
1. 플레이어로서, 라운드 시작 시 설정된 개수만큼 볼이 자동 생성되고, 각 볼이 확률적으로 희귀도가 정해지길 원한다.
2. 플레이어로서, 희귀도가 높을수록 더 높은 점수 배율과 구분 가능한 색상으로 보상을 받고 싶다.
3. 개발자로서, 볼 데이터 파일(Balls.json)과 id 관리 없이 희귀도 확률/개수만으로 볼 스폰을 제어하고 싶다.
4. 개발자로서, 상점에서 볼 판매/리롤/드래그 등 볼 관련 UI/코드를 제거해 유지보수 복잡도를 낮추고 싶다.

## Functional Requirements
1. 플레이어 데이터(Players.json)에 희귀도 확률(common/uncommon/rare/epic/legendary), 라운드당 볼 개수, 희귀도 성장율(기본 2)과 희귀도별 초기 배율을 정의하며, 플레이어마다 다른 값을 가질 수 있어야 한다. 기본 확률: 80/15/4/1/0%.
2. 라운드 시작 시 BallManager는 덱 정보를 사용해 “라운드당 볼 개수”만큼 볼 스폰을 트리거하고, 각 볼은 희귀도 확률 테이블로 자신의 희귀도를 결정한다.
3. 볼은 희귀도에 따라 색상을 변경한다(Colors.cs 매핑 재사용). 기존 볼 스프라이트는 유지하되 색상만 변경한다.
4. 볼은 희귀도에 따라 점수 배율을 갖는다. 기본 배율은 1/2/4/8/16이며, Players.json의 성장율(기본 2)을 런타임에 변경하면 희귀도별 배율이 재계산·반영되어 ScoreManager가 곱하도록 한다.
5. BallDto/Balls.json/볼 id 체계는 사용하지 않으며, 관련 로딩/레포지토리/팩토리 의존성을 제거하거나 무력화한다. BallInstance는 희귀도/배율/색상만을 보유하도록 단순화한다.
6. 상점에서 볼 판매(볼 아이템 로테이션, 리롤, 구매, 드래그 등) 관련 UI와 로직을 제거하고, 핀 관련 상점 동작은 그대로 유지한다.
7. 메인 메뉴 장식용 볼은 본 스펙에서는 제외(변경하지 않음).

## Non-Goals (Out of Scope)
- 핀/스테이지/옵션 등 다른 시스템의 기능 변경.
- 메인 메뉴 연출(볼/핀 데코) 변경.
- 희귀도 외 추가 볼 스탯/룰/이펙트 유지 또는 신규 설계.

## Design Considerations
- 희귀도 색상: Colors.cs에 정의된 희귀도별 색상을 사용. 기존 스프라이트에 색상만 적용.
- UI: 상점에서 볼 관련 패널/버튼/힌트/드래그 고스트 등을 숨기거나 제거. 핀 UI는 유지.
- 데이터: Players.json 스키마에 희귀도 확률/라운드당 볼 개수/희귀도 성장율(배율 계산용) 및 희귀도별 초기 배율 필드 추가 필요.

## Technical Considerations
- 데이터 로딩: StaticDataManager에서 Balls.json 로딩 제거. PlayerRepository에 희귀도 확률/볼 개수/희귀도별 배율을 포함하도록 확장.
- 모델: BallDto/BallRepository/BallFactory 등 id 기반 구성요소를 제거 또는 더미화. BallInstance를 희귀도·점수 배율·색상 중심으로 재구성하며, 성장율 변경 시 배율을 업데이트할 수 있는 구조로 둔다.
- 스폰: BallManager.PrepareSpawnSequence/StartSpawning 경로를 희귀도 테이블 기반 생성으로 교체.
- 점수: ScoreManager.CalculateScore에서 볼의 희귀도 배율을 곱하도록 변경.
- 상점: ShopManager에서 볼 관련 데이터 구조, UI 바인딩, 구매/리롤/드래그 로직 삭제. 관련 Prefab/뷰 스크립트 의존성 정리.
- 검증: Players.json 스키마 변경에 따른 런타임 검증 필요. 희귀도 확률 합이 100% 미만/초과면 에러 로그를 남기고 정규화하여 사용한다(추가 정책이 필요하면 후속 조정).

## Success Metrics
- Balls.json 및 BallDto 의존성 완전 제거 후 컴파일/런타임 에러 없음.
- 라운드 시작 시 설정된 개수의 볼이 생성되고 희귀도가 확률 분포에 따라 정상 분포(샘플링 테스트)로 부여됨.
- 상점 UI에서 볼 관련 요소가 나타나지 않고, 핀 구매/리롤이 정상 동작.
- 점수 계산이 희귀도 배율과 성장율 반영으로 TotalScore 증가가 기대대로 변동.

## Open Questions
- 희귀도 확률 합이 잘못된 경우: 에러 로그를 남기고 정규화하여 사용한다. 추후 다른 정책이 필요하면 후속 결정.
