# PRD: 결과창 아이템 데미지 통계 & 수입 표시

## 1. 개요/문제 정의
현재 `ResultManager`/`ResultOverlay`가 존재하지만 결과창이 즉시 닫혀 사용자에게 정보를 보여주지 못한다. 결과창에 아이템별 데미지 통계와 스테이지 수입을 표시하여, 플레이 결과를 명확히 확인할 수 있도록 한다.

## 2. 목표
- 결과창에서 **아이템 인스턴스별 데미지 통계**를 리스트로 표시한다.
- 결과창 하단에 **획득 수입(기본 수입 + 기본 수입 보너스)**을 표시한다.
- 결과창은 **확인 버튼**으로만 닫히며, 자동으로 닫히지 않는다.

## 3. 사용자 스토리
- 플레이어로서, 스테이지 플레이 후 어떤 아이템이 얼마만큼 데미지를 줬는지 확인하고 싶다.
- 플레이어로서, 이번 스테이지에서 얻은 수입을 확인하고 싶다.
- 플레이어로서, 결과를 확인한 후 확인 버튼으로 다음 단계로 진행하고 싶다.

## 4. 기능 요구사항
1) 시스템은 `StageManager.OnPlayFinished()` 흐름에서 결과창을 열고 **즉시 닫지 않는다**.  
2) 시스템은 결과창에 **ScrollView + VerticalLayoutGroup + ContentSizeFitter** 기반 리스트를 사용한다.  
3) 리스트는 **아이템 인스턴스(UniqueId) 단위**로 1행씩 표시한다. 같은 아이템이 여러 개면 여러 행으로 표시한다.  
4) 리스트 각 행에는 아래 요소를 포함한다.  
   - 아이템 아이콘: `SpriteCache.GetItemSprite(itemId)`  
   - 데미지 숫자: 정수 표시(소수점 제거), 예: `1234`  
   - 데미지 그래프 바: 1위 데미지를 100% 길이로 보고, 나머지는 비례 길이  
5) 리스트는 **데미지 내림차순**으로 정렬한다. 동률 순서는 중요하지 않다.  
6) 데미지 값이 0인 항목은 표시하지 않는다. 리스트가 비어 있으면 아무 것도 표시하지 않는다.  
7) 결과창 수입 표시는 `BaseIncome + BaseIncomeBonus` 값을 사용한다. (현 `ResultManager.Open()`에서 지급되는 수입과 동일)  
8) 확인 버튼 클릭 시 결과창을 닫고 `StageManager.OnResultClosed()`를 호출한다.  
9) `ResultManager`는 결과창이 열리는 시점에 **DamageTrackingManager 기록을 직접 읽어** 리스트를 구성하고, 열린 동안 실시간 갱신하지 않는다.  
10) 로컬라이즈 테이블은 **새 `result` 테이블**을 사용하며, **ko-KR만 입력**한다.  
11) `ResultManager`에서 정렬/필터링을 수행한다.

## 5. 비목표(Out of Scope)
- 게임 오버 시 별도 결과창 처리
- UI 애니메이션/이펙트 추가
- 데미지 외 추가 통계(치명타 수, 히트 수 등)
- 영문(EN) 로컬라이즈 입력

## 6. 디자인 고려사항
- 레이아웃 배치는 에디터에서 진행한다.  
- 결과창 구성 요소:
  - 상단: 결과 제목 텍스트  
  - 중단: 데미지 리스트(ScrollView + VerticalLayoutGroup + ContentSizeFitter)  
  - 하단: 수입 표시 + 확인 버튼  
- 데미지 그래프 바의 색상은 **고정 색상**을 사용한다.

## 7. 기술 고려사항
- `ResultManager.Open()`에서 자동 `Close()` 호출을 제거하거나 비활성화해야 한다.  
- `DamageTrackingManager`가 씬/매니저 루트에 존재해야 한다(에디터에서 추가).  
- `ResultManager`에서 `DamageTrackingManager` 기록을 직접 읽어 정렬/필터링한다.  
- 데미지 기록은 기존 로직 기준(`DamageContext.SourceItem != null`)을 사용한다.  
- 아이템 인스턴스의 UniqueId는 `System.Guid.NewGuid()`로 생성된 문자열을 사용한다.

## 8. 성공 지표
- 결과창이 자동으로 닫히지 않고 확인 버튼으로만 닫힌다.
- 아이템 인스턴스별 데미지 리스트가 내림차순으로 표시된다.
- 데미지 그래프 바가 1위 기준 비율로 표시된다.
- 수입 표시가 `BaseIncome + BaseIncomeBonus`와 동일하다.

## 9. 오픈 질문
- 없음
