# 가변 효과 툴팁 현재값 표시 PRD

## 1. 개요
일부 아이템/업그레이드 효과는 상황에 따라 수치가 변한다. 현재는 효과가 어느 정도 누적되었는지 툴팁에서 확인하기 어려워 플레이어가 실제 성능을 파악하기 힘들다. 본 기능은 툴팁에 “현재 수치”를 표시해 가변 효과의 체감과 이해도를 높인다.

## 2. 목표
- 가변 수치 표시를 위한 확장 가능한 구조를 설계한다.
- 가변 수치가 있는 아이템/강화의 툴팁에 현재값을 표시한다.
- 초기 적용 대상: `item.angel`, `upgrade.whetstone`.

## 3. 사용자 스토리
- 플레이어로서, 가변 효과가 실제로 얼마나 누적되었는지 즉시 확인하고 싶다.
- 플레이어로서, 아이템/강화를 비교할 때 현재 누적 효과를 판단 기준으로 삼고 싶다.

## 4. 기능 요구사항
1. 툴팁 효과 문구 뒤에 “현재값”을 추가 표기할 수 있어야 한다.
2. 가변 효과의 현재값은 **StatSet 기반**으로 계산한다.
3. 툴팁은 열려 있는 동안 값이 변하면 즉시 갱신되어야 한다.
4. 표시 포맷은 로컬라이즈 문자열에 의존하지 않고, 코드에서 문구 뒤에 덧붙이는 방식으로 한다.
5. “현재값” 표기에 사용할 새 키를 지원해야 한다.
6. 적용 언어는 `ko-KR`만 고려한다.

## 5. 비목표
- UI 프리팹/레이아웃 변경은 포함하지 않는다.
- 새로운 아이템/강화 추가는 포함하지 않는다. (기존 항목 문구 수정만)

## 6. 설계/구조 가이드
### 6.1 핵심 원칙
- 모든 가변 수치는 StatSet에서 읽는다.
- 툴팁 문구는 기존 `item.{id}.effect{index}` / `upgrade.{id}.effect{index}` 키를 유지한다.
- 현재값은 “effect 문자열 뒤에 추가”한다.

### 6.2 공통 해석기(Resolver)
- 공통 resolver가 “effect line → statId → currentValue”를 해석한다.
- 이 resolver는 **효과별 매핑 정의**를 한 곳에서 관리한다.
- 초기 매핑 대상:
  - `item.angel` 효과 라인 → `power`(혹은 해당 누적을 나타내는 statId)
  - `upgrade.whetstone` 효과 라인 → `damageMultiplier` 누적치(총 누적 %)

### 6.3 툴팁 표시 방식
- 기존 효과 문구 뒤에 `(현재 +X)` 형식으로 문자열을 덧붙인다.
- 현재값은 새 키를 사용한다.
  - 예시: `currentValue0`, `currentPercentValue0`
- 효과 문자열 자체는 그대로 유지하며, 현재값은 **코드 레벨에서 결합**한다.

### 6.4 갱신 타이밍
- 툴팁이 열려 있는 동안, 관련 stat 변화가 발생하면 즉시 재빌드한다.
- 변경 이벤트는 기존 스탯 변경 흐름을 활용한다.

## 7. 상세 요구사항 (초기 적용 대상)
### 7.1 item.angel
- 표기 대상: 스테이지 내 누적 파워 증가량.
- 기준: StatSet에서 해당 누적값을 읽는다.
- 표기: 효과 문구 뒤에 현재 누적값을 추가.

### 7.2 upgrade.whetstone
- 표기 대상: 지금까지 누적된 피해량 증가(총 누적 %).
- 기준: StatSet 누적치.
- 표기: 효과 문구 뒤에 현재 누적 퍼센트 값을 추가.

## 8. 성공 지표
- 플레이어가 툴팁에서 현재 누적 수치를 확인 가능.
- 대상 아이템/강화에서 실시간으로 수치가 반영됨.

## 9. 오픈 질문
- 각 효과 라인과 statId 매핑 정의 위치(데이터 vs 코드)는 확정 후 문서 반영.
- “현재값” 표기 문자열 포맷의 구체적 문구(예: ‘현재 +X’)는 로컬라이즈 테이블에 추가 필요 여부 결정.
